{"ast":null,"code":"var _jsxFileName = \"/home/ironhacker/Documents/M3/droy/src/contexts/authContext.js\";\nimport React, { Component } from \"react\";\nimport api from \"../services/apiClient\";\nimport { withRouter } from \"react-router-dom\";\nimport { auth } from '../services/firebase';\nexport const AuthContext = React.createContext();\nexport const withAuth = Comp => {\n  return class WithAuth extends Component {\n    render() {\n      return /*#__PURE__*/React.createElement(AuthContext.Consumer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 12,\n          columnNumber: 9\n        }\n      }, props => {\n        return /*#__PURE__*/React.createElement(Comp, Object.assign({\n          handleLogin: props.handleLogin,\n          user: props.user,\n          signUpError: props.signUpError,\n          authLoading: props.authLoading,\n          loginError: props.loginError,\n          handleSignUp: props.handleSignUp,\n          isLoggedIn: props.isLoggedIn,\n          handleLogout: props.handleLogout\n        }, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 15,\n            columnNumber: 15\n          }\n        }));\n      });\n    }\n\n  };\n};\n\nclass AuthProvider extends Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = async () => {\n      try {\n        auth.onAuthStateChanged(userAuth => {\n          this.setState({\n            firebaseUser: userAuth\n          });\n        });\n        const {\n          data: user\n        } = await api.get('/auth/whoami');\n        this.setState({\n          authLoading: false,\n          isLoggedIn: true,\n          user\n        });\n      } catch (error) {\n        this.setState({\n          authLoading: false,\n          isLoggedIn: false,\n          user: null\n        });\n      }\n    };\n\n    this.handleLogin = async ({\n      email,\n      hashedPassword\n    }) => {\n      try {\n        const {\n          history\n        } = this.props;\n        const {\n          data: user\n        } = await api.post('/auth/login', {\n          email,\n          hashedPassword\n        });\n        this.setState({\n          isLoggedIn: true,\n          user\n        });\n        auth().signInWithEmailAndPassword(email, hashedPassword).catch(function (error) {\n          console.log('in firebase login');\n          var errorCode = error.code;\n          var errorMessage = error.message;\n        });\n        history.push('/');\n      } catch (error) {\n        this.setState({\n          isLoggedIn: false,\n          user: null,\n          loginError: error.response.data.errors[0]\n        });\n      }\n    };\n\n    this.handleSignUp = async ({\n      email,\n      hashedPassword,\n      name,\n      confirmationPassword\n    }) => {\n      try {\n        const {\n          history\n        } = this.props;\n\n        if (hashedPassword !== confirmationPassword) {\n          this.setState({\n            signUpError: 'Incorrect passwords'\n          });\n          return;\n        }\n\n        const {\n          data: user\n        } = await api.post('/auth/signup', {\n          email,\n          hashedPassword,\n          name\n        });\n        auth.createUserWithEmailAndPassword(email, hashedPassword).catch(function (error) {\n          console.log('in sign up');\n          var errorCode = error.code;\n          var errorMessage = error.message;\n        });\n        console.log('signed up', firebase.auth().currentUser);\n        this.setState({\n          isLoggedIn: true,\n          user\n        });\n        history.push('/');\n      } catch (error) {\n        this.setState({\n          isLoggedIn: false,\n          user: null,\n          signUpError: error.response.data.errors[0]\n        });\n      }\n    };\n\n    this.handleLogout = async () => {\n      try {\n        const {\n          history\n        } = this.props;\n        await api.get('/auth/logout');\n        this.setState({\n          isLoggedIn: false,\n          user: null\n        }).auth().signOut().then(function () {\n          console.log('in sign out');\n        }).catch(function (error) {\n          console.log('in sign out error');\n        });\n        history.push('/login');\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    this.state = {\n      isLoggedIn: false,\n      user: null,\n      authLoading: true,\n      loginError: \"\",\n      firebaseUser: \"\"\n    };\n  }\n\n  render() {\n    const {\n      children\n    } = this.props;\n    const {\n      isLoggedIn,\n      user,\n      loginError,\n      authLoading,\n      signUpError\n    } = this.state;\n    return /*#__PURE__*/React.createElement(AuthContext.Provider, {\n      value: {\n        isLoggedIn,\n        user,\n        authLoading,\n        loginError,\n        signUpError,\n        handleLogin: this.handleLogin,\n        handleLogout: this.handleLogout,\n        handleSignUp: this.handleSignUp\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 7\n      }\n    }, children);\n  }\n\n}\n\nexport default withRouter(AuthProvider);","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/contexts/authContext.js"],"names":["React","Component","api","withRouter","auth","AuthContext","createContext","withAuth","Comp","WithAuth","render","props","handleLogin","user","signUpError","authLoading","loginError","handleSignUp","isLoggedIn","handleLogout","AuthProvider","constructor","componentDidMount","onAuthStateChanged","userAuth","setState","firebaseUser","data","get","error","email","hashedPassword","history","post","signInWithEmailAndPassword","catch","console","log","errorCode","code","errorMessage","message","push","response","errors","name","confirmationPassword","createUserWithEmailAndPassword","firebase","currentUser","signOut","then","state","children"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport api from \"../services/apiClient\";\nimport { withRouter } from \"react-router-dom\";\nimport { auth } from '../services/firebase'\n\nexport const AuthContext = React.createContext();\n\nexport const withAuth = (Comp) => {\n  return class WithAuth extends Component {\n    render() {\n      return (\n        <AuthContext.Consumer>\n          {(props) => {\n            return (\n              <Comp\n                handleLogin={props.handleLogin}\n                user={props.user}\n                signUpError={props.signUpError}\n                authLoading={props.authLoading}\n                loginError={props.loginError}\n                handleSignUp={props.handleSignUp}\n                isLoggedIn={props.isLoggedIn}\n                handleLogout={props.handleLogout}\n                {...this.props}\n              />\n            );\n          }}\n        </AuthContext.Consumer>\n      );\n    }\n  };\n};\n\nclass AuthProvider extends Component {\n  constructor(props){\n    super(props)\n    this.state = {\n      isLoggedIn: false,\n      user: null,\n      authLoading: true,\n      loginError: \"\",\n      firebaseUser: \"\"\n    };\n  }\n\n  componentDidMount = async () => {\n    try {\n      auth.onAuthStateChanged(userAuth => {\n        this.setState({ firebaseUser: userAuth});\n      });\n      const { data: user } = await api.get('/auth/whoami')\n      this.setState({\n        authLoading: false,\n        isLoggedIn: true,\n        user,\n      })\n    } catch (error) {\n      this.setState({\n        authLoading: false,\n        isLoggedIn: false,\n        user: null,\n      })      \n    }\n  }\n\n  handleLogin = async ({ email, hashedPassword }) => {\n    try {\n      const { history } = this.props\n      const { data: user } = await api.post('/auth/login', { email, hashedPassword })\n      this.setState({\n        isLoggedIn: true,\n        user,\n      });\n      auth().signInWithEmailAndPassword(email, hashedPassword).catch(function(error) {\n        console.log('in firebase login')\n        var errorCode = error.code;\n        var errorMessage = error.message;\n      });\n      history.push('/')\n    } catch (error) {\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n        loginError: error.response.data.errors[0]\n      })      \n    }\n  };\n\n\n  handleSignUp = async ({ email, hashedPassword, name, confirmationPassword }) => {\n    try {\n      const { history } = this.props\n      if(hashedPassword !== confirmationPassword){\n        this.setState({ signUpError: 'Incorrect passwords' })\n        return\n      } \n      const { data: user } = await api.post('/auth/signup', { email, hashedPassword, name })\n      auth.createUserWithEmailAndPassword(email, hashedPassword).catch(function(error) {\n        console.log('in sign up')\n        var errorCode = error.code;\n        var errorMessage = error.message;\n      });\n      console.log('signed up', firebase.auth().currentUser)\n      this.setState({\n        isLoggedIn: true,\n        user,\n      });\n      history.push('/')\n    } catch (error) {\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n        signUpError: error.response.data.errors[0]\n      })      \n    }\n  };\n\n  handleLogout = async () => {\n    try {\n      const { history } = this.props\n      await api.get('/auth/logout')\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n      })\n      .auth().signOut().then(function() {\n        console.log('in sign out')\n      }).catch(function(error) {\n        console.log('in sign out error')\n      });\n      history.push('/login')\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  render() {\n    const { children } = this.props;\n    const { isLoggedIn, user, loginError, authLoading, signUpError } = this.state;\n    return (\n      <AuthContext.Provider\n        value={{\n          isLoggedIn,\n          user,\n          authLoading,\n          loginError,\n          signUpError,\n          handleLogin: this.handleLogin,\n          handleLogout: this.handleLogout,\n          handleSignUp: this.handleSignUp\n        }}\n      >\n        {children}\n      </AuthContext.Provider>\n    );\n  }\n}\n\nexport default withRouter(AuthProvider);"]},"metadata":{},"sourceType":"module"}