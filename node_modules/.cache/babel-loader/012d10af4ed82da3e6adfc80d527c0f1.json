{"ast":null,"code":"import _regeneratorRuntime from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import api from'../services/apiClient';var DataContext=React.createContext();export var withData=function withData(Comp){return/*#__PURE__*/function(_Component){_inherits(WithData,_Component);var _super=_createSuper(WithData);function WithData(){_classCallCheck(this,WithData);return _super.apply(this,arguments);}_createClass(WithData,[{key:\"render\",value:function render(){var _this=this;return/*#__PURE__*/React.createElement(DataContext.Consumer,null,function(props){return/*#__PURE__*/React.createElement(Comp,Object.assign({},_this.props,props));});}}]);return WithData;}(Component);};var DataProvider=/*#__PURE__*/function(_Component2){_inherits(DataProvider,_Component2);var _super2=_createSuper(DataProvider);function DataProvider(props){var _this2;_classCallCheck(this,DataProvider);_this2=_super2.call(this,props);_this2.switchMode=function(){var mode=_this2.state.mode;_this2.setState({mode:mode==='edit'?'view':'edit'});};_this2.deleteComponent=function(elementCode){var stateCopy=_objectSpread({},_this2.state);var userLayoutObj=stateCopy.userLayoutObj;var fromIndex=0;for(var i=0;i<userLayoutObj.length;i++){var c=userLayoutObj[i];if(c.code!==elementCode)continue;fromIndex=i;break;}userLayoutObj.splice(fromIndex,1);_this2.setState({userLayoutObj:userLayoutObj});};_this2.moveComponent=function(elementCode,direction){var stateCopy=_objectSpread({},_this2.state);var userLayoutObj=stateCopy.userLayoutObj;var fromIndex=0;var element;for(var i=0;i<userLayoutObj.length;i++){var c=userLayoutObj[i];if(c.code===elementCode){element=c;fromIndex=i;break;}}userLayoutObj.splice(fromIndex,1);if(direction==='down')userLayoutObj.splice(fromIndex+1,0,element);else if(direction==='up')userLayoutObj.splice(fromIndex-1,0,element);_this2.setState({userLayoutObj:userLayoutObj});};_this2.addComponent=function(componentCode,defaultInfo,componentType){var stateCopy=_objectSpread({},_this2.state);stateCopy.userLayoutObj.push({code:componentCode,info:defaultInfo,componentType:componentType});_this2.setState({userLayoutObj:stateCopy.userLayoutObj});};_this2.save=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(projectId){var userLayoutObj;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_this2.setState({savingStep:'Saving...'});userLayoutObj=_this2.state.userLayoutObj;_context.next=5;return api.put(\"/projects/\".concat(projectId),{componentsConfiguration:userLayoutObj});case 5:setTimeout(function(){_this2.setState({savingStep:'OK'});setTimeout(function(){_this2.setState({savingStep:'Save'});},500);},500);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);alert(\"Error al guardar. Vuelve a intentarlo\");case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function(_x){return _ref.apply(this,arguments);};}();_this2.saveComponentInfoToContext=function(componentCode,componentAttr,attrContent){var stateCopy=_objectSpread({},_this2.state);var userLayoutObj=stateCopy.userLayoutObj;var component=userLayoutObj.find(function(userObject){return userObject.code===componentCode;});if(attrContent)component.info[componentAttr]=attrContent;else delete component.info[componentAttr];_this2.setState({userLayoutObj:userLayoutObj});};_this2.saveUserComponentStyleInfoToContext=function(componentCode,newStylePair){var stateCopy=_objectSpread({},_this2.state);var component=stateCopy.userLayoutObj.find(function(userObject){return userObject.code===componentCode;});if(!component.componentUserOverrideStyle)component.componentUserOverrideStyle=newStylePair;else Object.assign(component.componentUserOverrideStyle,newStylePair);_this2.setState({userLayoutObj:stateCopy.userLayoutObj});};_this2.getProjectInfo=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(projectId){var _yield$api$get,_yield$api$get$data,componentsConfiguration,style,_id;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return api.get(\"/projects/\".concat(projectId));case 3:_yield$api$get=_context2.sent;_yield$api$get$data=_yield$api$get.data;componentsConfiguration=_yield$api$get$data.componentsConfiguration;style=_yield$api$get$data.style;_id=_yield$api$get$data._id;_this2.setState({projectId:_id,userLayoutObj:componentsConfiguration,projectStyle:style});_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);_this2.setState({dataError:\"Unable to get your project data\"});case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this2.state={mode:'edit',userLayoutObj:[],projectStyle:\"\",projectId:\"\",dataError:\"\",savingStep:'Save'};return _this2;}/* Switch between edit/view modes */_createClass(DataProvider,[{key:\"render\",value:function render(){var children=this.props.children;return/*#__PURE__*/React.createElement(DataContext.Provider,{value:_objectSpread({saveComponentInfoToContext:this.saveComponentInfoToContext,getProjectInfo:this.getProjectInfo,switchMode:this.switchMode,moveComponent:this.moveComponent,addComponent:this.addComponent,deleteComponent:this.deleteComponent,save:this.save,saveUserComponentStyleInfoToContext:this.saveUserComponentStyleInfoToContext},this.state)},children);}}]);return DataProvider;}(Component);export default DataProvider;","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/contexts/dataContext.js"],"names":["React","Component","api","DataContext","createContext","withData","Comp","props","DataProvider","switchMode","mode","state","setState","deleteComponent","elementCode","stateCopy","userLayoutObj","fromIndex","i","length","c","code","splice","moveComponent","direction","element","addComponent","componentCode","defaultInfo","componentType","push","info","save","projectId","savingStep","put","componentsConfiguration","setTimeout","alert","saveComponentInfoToContext","componentAttr","attrContent","component","find","userObject","saveUserComponentStyleInfoToContext","newStylePair","componentUserOverrideStyle","Object","assign","getProjectInfo","get","data","style","_id","projectStyle","dataError","children"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport api from '../services/apiClient'\n\nconst DataContext = React.createContext()\n\nexport const withData = (Comp) => {\n  return class WithData extends Component {\n    render() {\n      return (\n        <DataContext.Consumer>\n          {(props) => <Comp {...this.props} {...props} />}\n        </DataContext.Consumer>\n      )\n    }\n  }\n}\n\nclass DataProvider extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      mode: 'edit',\n      userLayoutObj: [],\n      projectStyle: \"\",\n      projectId: \"\",\n      dataError: \"\",\n      savingStep: 'Save',\n    }\n  }\n\n  /* Switch between edit/view modes */\n  switchMode = () => {\n    const { mode } = this.state\n    this.setState({\n      mode: mode === 'edit' ? 'view' : 'edit'\n    })\n  }\n\n  /* Delete component from main layout */\n  deleteComponent = (elementCode) => {\n    const stateCopy = { ...this.state }\n    const { userLayoutObj } = stateCopy\n    let fromIndex = 0;\n    for (let i = 0; i < userLayoutObj.length; i++) {\n      const c = userLayoutObj[i];\n      if (c.code !== elementCode) continue\n      fromIndex = i\n      break\n    }\n    userLayoutObj.splice(fromIndex, 1)\n    this.setState({ userLayoutObj: userLayoutObj })\n  }\n\n  /* Move component position from main layout */\n  moveComponent = (elementCode, direction) => {\n    const stateCopy = { ...this.state }\n    const { userLayoutObj } = stateCopy\n    let fromIndex = 0; let element\n    for (let i = 0; i < userLayoutObj.length; i++) {\n      const c = userLayoutObj[i];\n      if (c.code === elementCode) {\n        element = c; fromIndex = i; break\n      }\n    }\n    userLayoutObj.splice(fromIndex, 1)\n    if (direction === 'down') userLayoutObj.splice(fromIndex + 1, 0, element)\n    else if (direction === 'up') userLayoutObj.splice(fromIndex - 1, 0, element)\n    this.setState({ userLayoutObj: userLayoutObj })\n  }\n\n  /* Add new component to actual configurarion */\n  addComponent = (componentCode, defaultInfo, componentType) => {\n    const stateCopy = {...this.state}\n    stateCopy.userLayoutObj.push({\n      code: componentCode,\n      info: defaultInfo,\n      componentType: componentType\n    })\n    this.setState({\n      userLayoutObj: stateCopy.userLayoutObj,\n    })\n  }\n\n  /* Save actual user configuration to BBDD */\n  save = async (projectId) => {\n    try {\n      this.setState({ savingStep: 'Saving...' })\n      const { userLayoutObj } = this.state\n      await api.put(`/projects/${projectId}`, { componentsConfiguration: userLayoutObj })\n      setTimeout(() => {\n        this.setState({ savingStep: 'OK' })\n        setTimeout(() => { this.setState({ savingStep: 'Save' }) }, 500);\n      }, 500);\n    } catch (error) {\n      alert(\"Error al guardar. Vuelve a intentarlo\")\n    }   \n  }\n\n  /* Update content configuration and rerender with it */\n  saveComponentInfoToContext = (componentCode, componentAttr, attrContent) => {\n    const stateCopy = {...this.state}\n    const { userLayoutObj } = stateCopy\n    const component = userLayoutObj.find(userObject => userObject.code === componentCode)\n    if (attrContent) component.info[componentAttr] = attrContent\n    else delete component.info[componentAttr]\n    this.setState({\n      userLayoutObj: userLayoutObj\n    })\n  };\n\n  /* Update style configuration and rerender with it */\n  saveUserComponentStyleInfoToContext = (componentCode, newStylePair) => {\n    const stateCopy = {...this.state}\n    const component = stateCopy.userLayoutObj.find(userObject => userObject.code === componentCode)\n    if (!component.componentUserOverrideStyle) component.componentUserOverrideStyle = newStylePair\n    else Object.assign(component.componentUserOverrideStyle, newStylePair)\n    this.setState({\n      userLayoutObj: stateCopy.userLayoutObj\n    })\n  }\n\n  /* Get project info to BBDD based on the project ID */\n  getProjectInfo = async (projectId) => {\n    try {\n      const { data: { componentsConfiguration, style, _id } } = await api.get(`/projects/${projectId}`)\n      this.setState({\n        projectId: _id,\n        userLayoutObj: componentsConfiguration,\n        projectStyle: style,\n      })\n    } catch (error) {\n      this.setState({ dataError: \"Unable to get your project data\" })\n    }\n  }\n\n  render () {\n    const { children } = this.props\n    return (\n      <DataContext.Provider value={{\n        saveComponentInfoToContext: this.saveComponentInfoToContext,\n        getProjectInfo: this.getProjectInfo,\n        switchMode: this.switchMode,\n        moveComponent: this.moveComponent,\n        addComponent: this.addComponent,\n        deleteComponent: this.deleteComponent,\n        save: this.save,\n        saveUserComponentStyleInfoToContext: this.saveUserComponentStyleInfoToContext,\n        ...this.state\n      }}>\n        {children}\n      </DataContext.Provider>\n    )\n  }\n}\n\nDataProvider.propTypes = {\n  children: PropTypes.node\n}\n\nexport default DataProvider\n"]},"metadata":{},"sourceType":"module"}