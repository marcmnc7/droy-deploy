{"ast":null,"code":"import _objectSpread from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import api from'../services/apiClient';import alias from'../utils/alias';var DataContext=React.createContext();export var withData=function withData(Comp){return/*#__PURE__*/function(_Component){_inherits(WithData,_Component);var _super=_createSuper(WithData);function WithData(){_classCallCheck(this,WithData);return _super.apply(this,arguments);}_createClass(WithData,[{key:\"render\",value:function render(){var _this=this;return/*#__PURE__*/React.createElement(DataContext.Consumer,null,function(props){return/*#__PURE__*/React.createElement(Comp,Object.assign({},_this.props,props));});}}]);return WithData;}(Component);};var DataProvider=/*#__PURE__*/function(_Component2){_inherits(DataProvider,_Component2);var _super2=_createSuper(DataProvider);function DataProvider(props){var _this2;_classCallCheck(this,DataProvider);_this2=_super2.call(this,props);_this2.switchMode=function(){var mode=_this2.state.mode;_this2.setState({mode:mode==='edit'?'view':'edit'});};_this2.deleteComponent=function(elementCode){var _alias$copyObject=alias.copyObject(_this2.state),userLayoutObj=_alias$copyObject.userLayoutObj;var fromIndex=0;for(var i=0;i<userLayoutObj.length;i++){var c=userLayoutObj[i];if(c.code!==elementCode)continue;fromIndex=i;break;}userLayoutObj.splice(fromIndex,1);_this2.setState({userLayoutObj:userLayoutObj});};_this2.moveComponent=function(elementCode,direction){var _alias$copyObject2=alias.copyObject(_this2.state),userLayoutObj=_alias$copyObject2.userLayoutObj;var fromIndex=0;var element;for(var i=0;i<userLayoutObj.length;i++){var c=userLayoutObj[i];if(c.code===elementCode){element=c;fromIndex=i;break;}}userLayoutObj.splice(fromIndex,1);if(direction==='down')userLayoutObj.splice(fromIndex+1,0,element);else if(direction==='up')userLayoutObj.splice(fromIndex-1,0,element);_this2.setState({userLayoutObj:userLayoutObj});};_this2.addComponent=function(componentCode,defaultInfo,componentOptions,componentStyle){var _alias$copyObject3=alias.copyObject(_this2.state),userLayoutObj=_alias$copyObject3.userLayoutObj;var firstStyle={};for(var attr in defaultInfo){firstStyle=Object.assign(firstStyle,_defineProperty({},attr,defaultInfo[attr].style));}var firstUserOverrideStyle={};for(var _attr in componentStyle){firstUserOverrideStyle=Object.assign(firstUserOverrideStyle,_defineProperty({},_attr,componentStyle[_attr]));}userLayoutObj.push({code:componentCode,info:defaultInfo,style:firstStyle,componentOptions:componentOptions,componentUserOverrideStyle:firstUserOverrideStyle});_this2.setState({userLayoutObj:userLayoutObj});};_this2.save=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(projectId){var userLayoutObj;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_this2.setState({savingStep:'Saving...'});userLayoutObj=_this2.state.userLayoutObj;_context.next=5;return api.put(\"/projects/\".concat(projectId),{componentsConfiguration:userLayoutObj});case 5:setTimeout(function(){_this2.setState({savingStep:'OK'});setTimeout(function(){_this2.setState({savingStep:'Save'});},500);},500);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);alert(\"Error al guardar. Vuelve a intentarlo\");case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function(_x){return _ref.apply(this,arguments);};}();_this2.saveComponentInfoToContext=function(componentCode,componentAttr,attrContent){var layoutCopy=alias.copyArray(_this2.state.userLayoutObj);var component=alias.findByCode(layoutCopy,componentCode);var styleOptions=['fontSize','letterSpacing'];var componentStyles=component.style;if(!attrContent)delete component.info[componentAttr];else{component.info[componentAttr]=attrContent;var stylesAttr={};for(var option in attrContent.style){if(!styleOptions.includes(option))continue;stylesAttr=_objectSpread(_objectSpread({},stylesAttr),{},_defineProperty({},option,attrContent.style[option]));componentStyles=Object.assign(componentStyles,_defineProperty({},componentAttr,stylesAttr));}}component.style=componentStyles;_this2.setState({userLayoutObj:layoutCopy});};_this2.saveUserComponentStyleInfoToContext=function(componentCode,newStylePair){var _alias$copyObject4=alias.copyObject(_this2.state),userLayoutObj=_alias$copyObject4.userLayoutObj;var component=alias.findByCode(userLayoutObj,componentCode);if(!component.componentUserOverrideStyle)component.componentUserOverrideStyle=newStylePair;else Object.assign(component.componentUserOverrideStyle,newStylePair);_this2.setState({userLayoutObj:userLayoutObj});};_this2.updateOrder=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(userLayoutObj){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this2.setState({userLayoutObj:userLayoutObj});case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this2.getProjectInfo=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(projectId){var _yield$api$get,_yield$api$get$data,componentsConfiguration,style,_id,firstStyle,key,component,componentInfo,attr;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return api.get(\"/projects/\".concat(projectId));case 3:_yield$api$get=_context3.sent;_yield$api$get$data=_yield$api$get.data;componentsConfiguration=_yield$api$get$data.componentsConfiguration;style=_yield$api$get$data.style;_id=_yield$api$get$data._id;firstStyle={};for(key in componentsConfiguration){component=componentsConfiguration[key];componentInfo=component.info;for(attr in componentInfo){firstStyle=Object.assign(firstStyle,_defineProperty({},attr,componentInfo[attr].style));}component.style=firstStyle;}_this2.setState({projectId:_id,userLayoutObj:componentsConfiguration,projectStyle:style});_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](0);_this2.setState({dataError:\"Unable to get your project data\"});case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[0,13]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();_this2.state={mode:'edit',userLayoutObj:[],projectStyle:\"\",projectId:\"\",dataError:\"\",savingStep:'Save'};return _this2;}/* Switch between edit/view modes */_createClass(DataProvider,[{key:\"render\",value:function render(){var children=this.props.children;return/*#__PURE__*/React.createElement(DataContext.Provider,{value:_objectSpread({saveUserComponentStyleInfoToContext:this.saveUserComponentStyleInfoToContext,saveComponentInfoToContext:this.saveComponentInfoToContext,deleteComponent:this.deleteComponent,getProjectInfo:this.getProjectInfo,moveComponent:this.moveComponent,addComponent:this.addComponent,switchMode:this.switchMode,updateOrder:this.updateOrder,save:this.save},this.state)},children);}}]);return DataProvider;}(Component);export default DataProvider;","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/contexts/dataContext.js"],"names":["React","Component","api","alias","DataContext","createContext","withData","Comp","props","DataProvider","switchMode","mode","state","setState","deleteComponent","elementCode","copyObject","userLayoutObj","fromIndex","i","length","c","code","splice","moveComponent","direction","element","addComponent","componentCode","defaultInfo","componentOptions","componentStyle","firstStyle","attr","Object","assign","style","firstUserOverrideStyle","push","info","componentUserOverrideStyle","save","projectId","savingStep","put","componentsConfiguration","setTimeout","alert","saveComponentInfoToContext","componentAttr","attrContent","layoutCopy","copyArray","component","findByCode","styleOptions","componentStyles","stylesAttr","option","includes","saveUserComponentStyleInfoToContext","newStylePair","updateOrder","getProjectInfo","get","data","_id","key","componentInfo","projectStyle","dataError","children"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport api from '../services/apiClient'\nimport alias from '../utils/alias'\n\nconst DataContext = React.createContext()\n\nexport const withData = (Comp) => {\n  return class WithData extends Component {\n    render() {\n      return (\n        <DataContext.Consumer>\n          {(props) => <Comp {...this.props} {...props} />}\n        </DataContext.Consumer>\n      )\n    }\n  }\n}\n\nclass DataProvider extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      mode: 'edit',\n      userLayoutObj: [],\n      projectStyle: \"\",\n      projectId: \"\",\n      dataError: \"\",\n      savingStep: 'Save',\n    }\n  }\n\n  /* Switch between edit/view modes */\n  switchMode = () => {\n    const { mode } = this.state\n    this.setState({\n      mode: mode === 'edit' ? 'view' : 'edit'\n    })\n  }\n\n  /* Delete component from main layout */\n  deleteComponent = (elementCode) => {\n    const { userLayoutObj } = alias.copyObject(this.state)\n    let fromIndex = 0;\n    for (let i = 0; i < userLayoutObj.length; i++) {\n      const c = userLayoutObj[i];\n      if (c.code !== elementCode) continue\n      fromIndex = i\n      break\n    }\n    userLayoutObj.splice(fromIndex, 1)\n    this.setState({ userLayoutObj: userLayoutObj })\n  }\n\n  /* Move component position from main layout */\n  moveComponent = (elementCode, direction) => {\n    const { userLayoutObj } = alias.copyObject(this.state)\n    let fromIndex = 0\n    let element\n    for (let i = 0; i < userLayoutObj.length; i++) {\n      const c = userLayoutObj[i];\n      if (c.code === elementCode) {\n        element = c\n        fromIndex = i\n        break\n      }\n    }\n    userLayoutObj.splice(fromIndex, 1)\n    if (direction === 'down') userLayoutObj.splice(fromIndex + 1, 0, element)\n    else if (direction === 'up') userLayoutObj.splice(fromIndex - 1, 0, element)\n    this.setState({ userLayoutObj: userLayoutObj })\n  }\n\n  /* Add new component to actual configurarion */\n  addComponent = (componentCode, defaultInfo, componentOptions, componentStyle) => {\n    const { userLayoutObj } = alias.copyObject(this.state)\n    let firstStyle = {}\n    for (const attr in defaultInfo) {\n      firstStyle = Object.assign(firstStyle, {[attr]: defaultInfo[attr].style})\n    }\n    let firstUserOverrideStyle = {}\n    for (const attr in componentStyle) {\n      firstUserOverrideStyle = Object.assign(firstUserOverrideStyle, {[attr]: componentStyle[attr]})\n    }\n    userLayoutObj.push({\n      code: componentCode,\n      info: defaultInfo,\n      style: firstStyle,\n      componentOptions,\n      componentUserOverrideStyle: firstUserOverrideStyle\n    })\n    this.setState({\n      userLayoutObj: userLayoutObj,\n    })\n  }\n\n  /* Save actual user configuration to BBDD */\n  save = async (projectId) => {\n    try {\n      this.setState({ savingStep: 'Saving...' })\n      const { userLayoutObj } = this.state\n      await api.put(`/projects/${projectId}`, { componentsConfiguration: userLayoutObj })\n      setTimeout(() => {\n        this.setState({ savingStep: 'OK' })\n        setTimeout(() => { this.setState({ savingStep: 'Save' }) }, 500);\n      }, 500);\n    } catch (error) {\n      alert(\"Error al guardar. Vuelve a intentarlo\")\n    }   \n  }\n\n  /* Update content configuration and rerender with it */\n  saveComponentInfoToContext = (componentCode, componentAttr, attrContent) => {\n    const layoutCopy = alias.copyArray(this.state.userLayoutObj)\n    const component = alias.findByCode(layoutCopy, componentCode)\n    const styleOptions = ['fontSize', 'letterSpacing']\n    let componentStyles = component.style\n    if(!attrContent) delete component.info[componentAttr]\n    else {\n      component.info[componentAttr] = attrContent\n      let stylesAttr = {}\n      for (const option in attrContent.style) {\n        if (!styleOptions.includes(option)) continue\n        stylesAttr = {...stylesAttr, [option]: attrContent.style[option]}\n        componentStyles = Object.assign(componentStyles, {[componentAttr]: stylesAttr})\n      }\n    }\n    component.style = componentStyles\n    this.setState({ userLayoutObj: layoutCopy })\n  };\n\n  /* Update style configuration and rerender with it */\n  saveUserComponentStyleInfoToContext = (componentCode, newStylePair) => {\n    const { userLayoutObj } = alias.copyObject(this.state)\n    const component = alias.findByCode(userLayoutObj, componentCode)\n    if (!component.componentUserOverrideStyle) component.componentUserOverrideStyle = newStylePair\n    else Object.assign(component.componentUserOverrideStyle, newStylePair)\n    this.setState({\n      userLayoutObj: userLayoutObj\n    })\n  }\n\n  updateOrder = async (userLayoutObj) => {\n    this.setState({ userLayoutObj })\n  }\n\n  /* Get project info to BBDD based on the project ID */\n  getProjectInfo = async (projectId) => {\n    try {\n      const { data: { componentsConfiguration, style, _id } } = await api.get(`/projects/${projectId}`)\n      let firstStyle = {}\n      for (const key in componentsConfiguration) {\n        const component = componentsConfiguration[key]\n        const componentInfo = component.info\n        for (const attr in componentInfo) {\n          firstStyle = Object.assign(firstStyle, {[attr]: componentInfo[attr].style})\n        }\n        component.style = firstStyle\n      }\n      this.setState({\n        projectId: _id,\n        userLayoutObj: componentsConfiguration,\n        projectStyle: style,\n      })\n    } catch (error) {\n      this.setState({ dataError: \"Unable to get your project data\" })\n    }\n  }\n\n  render () {\n    const { children } = this.props\n    return (\n      <DataContext.Provider value={{\n        saveUserComponentStyleInfoToContext: this.saveUserComponentStyleInfoToContext,\n        saveComponentInfoToContext: this.saveComponentInfoToContext,\n        deleteComponent: this.deleteComponent,\n        getProjectInfo: this.getProjectInfo,\n        moveComponent: this.moveComponent,\n        addComponent: this.addComponent,\n        switchMode: this.switchMode,\n        updateOrder: this.updateOrder,\n        save: this.save,\n        ...this.state\n      }}>\n        {children}\n      </DataContext.Provider>\n    )\n  }\n}\n\nDataProvider.propTypes = {\n  children: PropTypes.node\n}\n\nexport default DataProvider\n"]},"metadata":{},"sourceType":"module"}