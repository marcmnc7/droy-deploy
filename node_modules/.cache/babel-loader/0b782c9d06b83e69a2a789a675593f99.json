{"ast":null,"code":"var _jsxFileName = \"/home/ironhacker/Documents/M3/droy/src/contexts/dataContext.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from '../services/apiClient';\nimport alias from '../utils/alias';\nconst DataContext = React.createContext();\nexport const withData = Comp => {\n  return class WithData extends Component {\n    render() {\n      return /*#__PURE__*/React.createElement(DataContext.Consumer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 12,\n          columnNumber: 9\n        }\n      }, props => /*#__PURE__*/React.createElement(Comp, Object.assign({}, this.props, props, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 13,\n          columnNumber: 23\n        }\n      })));\n    }\n\n  };\n};\n\nclass DataProvider extends Component {\n  constructor(props) {\n    super(props);\n\n    this.switchMode = () => {\n      const {\n        mode\n      } = this.state;\n      this.setState({\n        mode: mode === 'edit' ? 'view' : 'edit'\n      });\n    };\n\n    this.deleteComponent = elementCode => {\n      const {\n        userLayoutObj\n      } = alias.copyObject(this.state);\n      let fromIndex = 0;\n\n      for (let i = 0; i < userLayoutObj.length; i++) {\n        const c = userLayoutObj[i];\n        if (c.code !== elementCode) continue;\n        fromIndex = i;\n        break;\n      }\n\n      userLayoutObj.splice(fromIndex, 1);\n      this.setState({\n        userLayoutObj: userLayoutObj\n      });\n    };\n\n    this.moveComponent = (elementCode, direction) => {\n      const {\n        userLayoutObj\n      } = alias.copyObject(this.state);\n      let fromIndex = 0;\n      let element;\n\n      for (let i = 0; i < userLayoutObj.length; i++) {\n        const c = userLayoutObj[i];\n\n        if (c.code === elementCode) {\n          element = c;\n          fromIndex = i;\n          break;\n        }\n      }\n\n      userLayoutObj.splice(fromIndex, 1);\n      if (direction === 'down') userLayoutObj.splice(fromIndex + 1, 0, element);else if (direction === 'up') userLayoutObj.splice(fromIndex - 1, 0, element);\n      this.setState({\n        userLayoutObj: userLayoutObj\n      });\n    };\n\n    this.addComponent = (componentCode, defaultInfo, componentOptions, componentStyle) => {\n      const {\n        userLayoutObj\n      } = alias.copyObject(this.state);\n      let firstStyle = {};\n      console.warn(defaultInfo);\n\n      for (const attr in defaultInfo) {\n        firstStyle = Object.assign(firstStyle, {\n          [componentCode]: {\n            [attr]: defaultInfo[attr].style\n          }\n        });\n      }\n\n      let firstUserOverrideStyle = {};\n\n      for (const attr in componentStyle) {\n        firstUserOverrideStyle = Object.assign(firstUserOverrideStyle, {\n          [attr]: componentStyle[attr]\n        });\n      }\n\n      console.log(firstStyle);\n      userLayoutObj.push({\n        code: componentCode,\n        info: defaultInfo,\n        style: firstStyle,\n        componentOptions,\n        componentUserOverrideStyle: firstUserOverrideStyle\n      });\n      this.setState({\n        userLayoutObj: userLayoutObj\n      });\n    };\n\n    this.save = async projectId => {\n      try {\n        this.setState({\n          savingStep: 'Saving...'\n        });\n        const {\n          userLayoutObj\n        } = this.state;\n        await api.put(`/projects/${projectId}`, {\n          componentsConfiguration: userLayoutObj\n        });\n        setTimeout(() => {\n          this.setState({\n            savingStep: 'OK'\n          });\n          setTimeout(() => {\n            this.setState({\n              savingStep: 'Save'\n            });\n          }, 500);\n        }, 500);\n      } catch (error) {\n        alert(\"Error al guardar. Vuelve a intentarlo\");\n      }\n    };\n\n    this.saveComponentInfoToContext = (componentCode, componentAttr, attrContent) => {\n      const layoutCopy = alias.copyArray(this.state.userLayoutObj);\n      const component = alias.findByCode(layoutCopy, componentCode);\n      const styleOptions = ['fontSize', 'letterSpacing'];\n      let componentStyles = component.style;\n      if (!attrContent) delete component.info[componentAttr];else {\n        component.info[componentAttr] = attrContent;\n        let stylesAttr = {};\n\n        for (const option in attrContent.style) {\n          if (!styleOptions.includes(option)) continue;\n          stylesAttr = { ...stylesAttr,\n            [option]: attrContent.style[option]\n          };\n          componentStyles = Object.assign(componentStyles, {\n            [componentAttr]: stylesAttr\n          });\n        }\n      }\n      component.style = componentStyles;\n      this.setState({\n        userLayoutObj: layoutCopy\n      });\n    };\n\n    this.saveUserComponentStyleInfoToContext = (componentCode, newStylePair) => {\n      const {\n        userLayoutObj\n      } = alias.copyObject(this.state);\n      const component = alias.findByCode(userLayoutObj, componentCode);\n      if (!component.componentUserOverrideStyle) component.componentUserOverrideStyle = newStylePair;else Object.assign(component.componentUserOverrideStyle, newStylePair);\n      this.setState({\n        userLayoutObj: userLayoutObj\n      });\n    };\n\n    this.updateOrder = async userLayoutObj => {\n      this.setState({\n        userLayoutObj\n      });\n    };\n\n    this.getProjectInfo = async projectId => {\n      try {\n        const {\n          data: {\n            componentsConfiguration,\n            style,\n            _id\n          }\n        } = await api.get(`/projects/${projectId}`);\n        let firstStyle = {};\n\n        for (const key in componentsConfiguration) {\n          const component = componentsConfiguration[key];\n          const componentInfo = component.info;\n\n          for (const attr in componentInfo) {\n            firstStyle = Object.assign(firstStyle, {\n              [attr]: componentInfo[attr].style\n            });\n          }\n\n          component.style = firstStyle;\n        }\n\n        this.setState({\n          projectId: _id,\n          userLayoutObj: componentsConfiguration,\n          projectStyle: style\n        });\n      } catch (error) {\n        this.setState({\n          dataError: \"Unable to get your project data\"\n        });\n      }\n    };\n\n    this.state = {\n      mode: 'edit',\n      userLayoutObj: [],\n      projectStyle: \"\",\n      projectId: \"\",\n      dataError: \"\",\n      savingStep: 'Save'\n    };\n  }\n  /* Switch between edit/view modes */\n\n\n  render() {\n    const {\n      children\n    } = this.props;\n    return /*#__PURE__*/React.createElement(DataContext.Provider, {\n      value: {\n        saveUserComponentStyleInfoToContext: this.saveUserComponentStyleInfoToContext,\n        saveComponentInfoToContext: this.saveComponentInfoToContext,\n        deleteComponent: this.deleteComponent,\n        getProjectInfo: this.getProjectInfo,\n        moveComponent: this.moveComponent,\n        addComponent: this.addComponent,\n        switchMode: this.switchMode,\n        updateOrder: this.updateOrder,\n        save: this.save,\n        ...this.state\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 7\n      }\n    }, children);\n  }\n\n}\n\nDataProvider.propTypes = {\n  children: PropTypes.node\n};\nexport default DataProvider;","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/contexts/dataContext.js"],"names":["React","Component","PropTypes","api","alias","DataContext","createContext","withData","Comp","WithData","render","props","DataProvider","constructor","switchMode","mode","state","setState","deleteComponent","elementCode","userLayoutObj","copyObject","fromIndex","i","length","c","code","splice","moveComponent","direction","element","addComponent","componentCode","defaultInfo","componentOptions","componentStyle","firstStyle","console","warn","attr","Object","assign","style","firstUserOverrideStyle","log","push","info","componentUserOverrideStyle","save","projectId","savingStep","put","componentsConfiguration","setTimeout","error","alert","saveComponentInfoToContext","componentAttr","attrContent","layoutCopy","copyArray","component","findByCode","styleOptions","componentStyles","stylesAttr","option","includes","saveUserComponentStyleInfoToContext","newStylePair","updateOrder","getProjectInfo","data","_id","get","key","componentInfo","projectStyle","dataError","children","propTypes","node"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport api from '../services/apiClient'\nimport alias from '../utils/alias'\n\nconst DataContext = React.createContext()\n\nexport const withData = (Comp) => {\n  return class WithData extends Component {\n    render() {\n      return (\n        <DataContext.Consumer>\n          {(props) => <Comp {...this.props} {...props} />}\n        </DataContext.Consumer>\n      )\n    }\n  }\n}\n\nclass DataProvider extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      mode: 'edit',\n      userLayoutObj: [],\n      projectStyle: \"\",\n      projectId: \"\",\n      dataError: \"\",\n      savingStep: 'Save',\n    }\n  }\n\n  /* Switch between edit/view modes */\n  switchMode = () => {\n    const { mode } = this.state\n    this.setState({\n      mode: mode === 'edit' ? 'view' : 'edit'\n    })\n  }\n\n  /* Delete component from main layout */\n  deleteComponent = (elementCode) => {\n    const { userLayoutObj } = alias.copyObject(this.state)\n    let fromIndex = 0;\n    for (let i = 0; i < userLayoutObj.length; i++) {\n      const c = userLayoutObj[i];\n      if (c.code !== elementCode) continue\n      fromIndex = i\n      break\n    }\n    userLayoutObj.splice(fromIndex, 1)\n    this.setState({ userLayoutObj: userLayoutObj })\n  }\n\n  /* Move component position from main layout */\n  moveComponent = (elementCode, direction) => {\n    const { userLayoutObj } = alias.copyObject(this.state)\n    let fromIndex = 0\n    let element\n    for (let i = 0; i < userLayoutObj.length; i++) {\n      const c = userLayoutObj[i];\n      if (c.code === elementCode) {\n        element = c\n        fromIndex = i\n        break\n      }\n    }\n    userLayoutObj.splice(fromIndex, 1)\n    if (direction === 'down') userLayoutObj.splice(fromIndex + 1, 0, element)\n    else if (direction === 'up') userLayoutObj.splice(fromIndex - 1, 0, element)\n    this.setState({ userLayoutObj: userLayoutObj })\n  }\n\n  /* Add new component to actual configurarion */\n  addComponent = (componentCode, defaultInfo, componentOptions, componentStyle) => {\n    const { userLayoutObj } = alias.copyObject(this.state)\n    let firstStyle = {}\n    console.warn(defaultInfo)\n    for (const attr in defaultInfo) {\n      firstStyle = Object.assign(firstStyle, {[componentCode]: {[attr]: defaultInfo[attr].style}})\n    }\n    let firstUserOverrideStyle = {}\n    for (const attr in componentStyle) {\n      firstUserOverrideStyle = Object.assign(firstUserOverrideStyle, {[attr]: componentStyle[attr]})\n    }\n    console.log(firstStyle)\n    userLayoutObj.push({\n      code: componentCode,\n      info: defaultInfo,\n      style: firstStyle,\n      componentOptions,\n      componentUserOverrideStyle: firstUserOverrideStyle\n    })\n    this.setState({\n      userLayoutObj: userLayoutObj,\n    })\n  }\n\n  /* Save actual user configuration to BBDD */\n  save = async (projectId) => {\n    try {\n      this.setState({ savingStep: 'Saving...' })\n      const { userLayoutObj } = this.state\n      await api.put(`/projects/${projectId}`, { componentsConfiguration: userLayoutObj })\n      setTimeout(() => {\n        this.setState({ savingStep: 'OK' })\n        setTimeout(() => { this.setState({ savingStep: 'Save' }) }, 500);\n      }, 500);\n    } catch (error) {\n      alert(\"Error al guardar. Vuelve a intentarlo\")\n    }   \n  }\n\n  /* Update content configuration and rerender with it */\n  saveComponentInfoToContext = (componentCode, componentAttr, attrContent) => {\n    const layoutCopy = alias.copyArray(this.state.userLayoutObj)\n    const component = alias.findByCode(layoutCopy, componentCode)\n    const styleOptions = ['fontSize', 'letterSpacing']\n    let componentStyles = component.style\n    if(!attrContent) delete component.info[componentAttr]\n    else {\n      component.info[componentAttr] = attrContent\n      let stylesAttr = {}\n      for (const option in attrContent.style) {\n        if (!styleOptions.includes(option)) continue\n        stylesAttr = {...stylesAttr, [option]: attrContent.style[option]}\n        componentStyles = Object.assign(componentStyles, {[componentAttr]: stylesAttr})\n      }\n    }\n    component.style = componentStyles\n    this.setState({ userLayoutObj: layoutCopy })\n  };\n\n  /* Update style configuration and rerender with it */\n  saveUserComponentStyleInfoToContext = (componentCode, newStylePair) => {\n    const { userLayoutObj } = alias.copyObject(this.state)\n    const component = alias.findByCode(userLayoutObj, componentCode)\n    if (!component.componentUserOverrideStyle) component.componentUserOverrideStyle = newStylePair\n    else Object.assign(component.componentUserOverrideStyle, newStylePair)\n    this.setState({\n      userLayoutObj: userLayoutObj\n    })\n  }\n\n  updateOrder = async (userLayoutObj) => {\n    this.setState({ userLayoutObj })\n  }\n\n  /* Get project info to BBDD based on the project ID */\n  getProjectInfo = async (projectId) => {\n    try {\n      const { data: { componentsConfiguration, style, _id } } = await api.get(`/projects/${projectId}`)\n      let firstStyle = {}\n      for (const key in componentsConfiguration) {\n        const component = componentsConfiguration[key]\n        const componentInfo = component.info\n        for (const attr in componentInfo) {\n          firstStyle = Object.assign(firstStyle, {[attr]: componentInfo[attr].style})\n        }\n        component.style = firstStyle\n      }\n      this.setState({\n        projectId: _id,\n        userLayoutObj: componentsConfiguration,\n        projectStyle: style,\n      })\n    } catch (error) {\n      this.setState({ dataError: \"Unable to get your project data\" })\n    }\n  }\n\n  render () {\n    const { children } = this.props\n    return (\n      <DataContext.Provider value={{\n        saveUserComponentStyleInfoToContext: this.saveUserComponentStyleInfoToContext,\n        saveComponentInfoToContext: this.saveComponentInfoToContext,\n        deleteComponent: this.deleteComponent,\n        getProjectInfo: this.getProjectInfo,\n        moveComponent: this.moveComponent,\n        addComponent: this.addComponent,\n        switchMode: this.switchMode,\n        updateOrder: this.updateOrder,\n        save: this.save,\n        ...this.state\n      }}>\n        {children}\n      </DataContext.Provider>\n    )\n  }\n}\n\nDataProvider.propTypes = {\n  children: PropTypes.node\n}\n\nexport default DataProvider\n"]},"metadata":{},"sourceType":"module"}