{"ast":null,"code":"var _jsxFileName = \"/home/ironhacker/Documents/M3/droy/src/contexts/authContext.js\";\nimport React, { Component } from \"react\";\nimport api from \"../services/apiClient\";\nimport { withRouter } from \"react-router-dom\";\nimport firebase from '../services/firebase';\nimport apiClient from \"../services/apiClient\";\nimport axios from \"axios\";\nexport const AuthContext = React.createContext();\nexport const withAuth = Comp => {\n  return class WithAuth extends Component {\n    render() {\n      return /*#__PURE__*/React.createElement(AuthContext.Consumer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 14,\n          columnNumber: 9\n        }\n      }, props => {\n        return /*#__PURE__*/React.createElement(Comp, Object.assign({\n          handleLogin: props.handleLogin,\n          user: props.user,\n          signUpError: props.signUpError,\n          authLoading: props.authLoading,\n          loginError: props.loginError,\n          handleSignUp: props.handleSignUp,\n          handleGoogleLogin: props.handleGoogleLogin,\n          handleGoogleSignup: props.handleGoogleSignup,\n          isLoggedIn: props.isLoggedIn,\n          handleLogout: props.handleLogout\n        }, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 17,\n            columnNumber: 15\n          }\n        }));\n      });\n    }\n\n  };\n};\n\nclass AuthProvider extends Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = async () => {\n      try {\n        const {\n          data: user\n        } = await api.get('/auth/whoami');\n        this.setState({\n          user,\n          isLoggedIn: true,\n          authLoading: false\n        });\n      } catch (error) {\n        this.setState({\n          user: null,\n          isLoggedIn: false,\n          authLoading: false\n        });\n      }\n    };\n\n    this.handleLogin = async ({\n      email,\n      hashedPassword\n    }) => {\n      try {\n        const {\n          history\n        } = this.props;\n        firebase.auth().signInWithEmailAndPassword('user@example.com', 'password').then(user => {\n          return user.getIdToken().then(idToken => {\n            // const csrfToken = getCookie('csrfToken')\n            const token = api.post('/tokensignin', idToken);\n            console.log(77777777777, token);\n          });\n        }).then(() => {\n          // A page redirect would suffice as the persistence is set to NONE.\n          return firebase.auth().signOut();\n        }).then(() => {\n          window.location.assign('/profile');\n        });\n        /*\n        // const { data: user } = await api.post('/auth/login', { email, hashedPassword })\n        this.setState({\n          isLoggedIn: true,\n          user,\n        })      \n        history.push('/') */\n      } catch (error) {\n        this.setState({\n          isLoggedIn: false,\n          user: null,\n          loginError: \"Incorrect user or password\"\n        });\n      }\n    };\n\n    this.handleGoogleLogin = async googleUser => {\n      try {\n        const {\n          history\n        } = this.props;\n        /*\n        var id_token = googleUser.getAuthResponse().id_token;\n        const { data: user } = await axios.post('http://localhost:3005/auth/tokensignin', `idtoken=${id_token}`, { headers: {'Content-Type': 'application/x-www-form-urlencoded'}})\n        */\n\n        this.setState({\n          isLoggedIn: true,\n          user: user.user\n        });\n        history.push('/');\n      } catch (error) {\n        this.setState({\n          isLoggedIn: false,\n          user: null,\n          loginError: \"User not exists\"\n        });\n      }\n    };\n\n    this.handleGoogleSignup = async googleUser => {\n      try {\n        const {\n          history\n        } = this.props;\n        var id_token = googleUser.getAuthResponse().id_token;\n        const user = await axios.post('http://localhost:3005/auth/tokensignup', `idtoken=${id_token}`, {\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n          }\n        });\n        this.setState({\n          isLoggedIn: true,\n          user\n        });\n        history.push('/');\n      } catch (error) {\n        this.setState({\n          isLoggedIn: false,\n          user: null,\n          loginError: \"Error on signup\"\n        });\n      }\n    };\n\n    this.handleSignUp = async ({\n      email,\n      hashedPassword,\n      name,\n      confirmationPassword\n    }) => {\n      try {\n        const {\n          history\n        } = this.props;\n\n        if (hashedPassword !== confirmationPassword || hashedPassword.lenght < 6) {\n          this.setState({\n            signUpError: 'Incorrect passwords or weak password'\n          });\n          return;\n        }\n\n        const {\n          data: user\n        } = await api.post('/auth/signup', {\n          email,\n          hashedPassword,\n          name\n        });\n        this.setState({\n          isLoggedIn: true,\n          user\n        });\n        history.push('/');\n      } catch (error) {\n        this.setState({\n          isLoggedIn: false,\n          user: null,\n          loginError: \"Error on signup\"\n        });\n      }\n    };\n\n    this.handleLogout = async () => {\n      try {\n        const {\n          history\n        } = this.props;\n        await api.get('/auth/logout');\n        this.setState({\n          isLoggedIn: false,\n          user: null\n        });\n        history.push('/login');\n      } catch (error) {\n        console.log('Error on logout');\n      }\n    };\n\n    this.state = {\n      isLoggedIn: false,\n      user: null,\n      authLoading: true,\n      loginError: \"\",\n      firebaseUser: \"\"\n    };\n  }\n\n  render() {\n    const {\n      children\n    } = this.props;\n    const {\n      isLoggedIn,\n      user,\n      loginError,\n      authLoading,\n      signUpError\n    } = this.state;\n    return /*#__PURE__*/React.createElement(AuthContext.Provider, {\n      value: {\n        isLoggedIn,\n        user,\n        authLoading,\n        loginError,\n        signUpError,\n        handleLogin: this.handleLogin,\n        handleGoogleLogin: this.handleGoogleLogin,\n        handleGoogleSignup: this.handleGoogleSignup,\n        handleLogout: this.handleLogout,\n        handleSignUp: this.handleSignUp\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 7\n      }\n    }, children);\n  }\n\n}\n\nexport default withRouter(AuthProvider);","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/contexts/authContext.js"],"names":["React","Component","api","withRouter","firebase","apiClient","axios","AuthContext","createContext","withAuth","Comp","WithAuth","render","props","handleLogin","user","signUpError","authLoading","loginError","handleSignUp","handleGoogleLogin","handleGoogleSignup","isLoggedIn","handleLogout","AuthProvider","constructor","componentDidMount","data","get","setState","error","email","hashedPassword","history","auth","signInWithEmailAndPassword","then","getIdToken","idToken","token","post","console","log","signOut","window","location","assign","googleUser","push","id_token","getAuthResponse","headers","name","confirmationPassword","lenght","state","firebaseUser","children"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,GAAP,MAAgB,uBAAhB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,QAAP,MAAqB,sBAArB;AACA,OAAOC,SAAP,MAAsB,uBAAtB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,OAAO,MAAMC,WAAW,GAAGP,KAAK,CAACQ,aAAN,EAApB;AAEP,OAAO,MAAMC,QAAQ,GAAIC,IAAD,IAAU;AAChC,SAAO,MAAMC,QAAN,SAAuBV,SAAvB,CAAiC;AACtCW,IAAAA,MAAM,GAAG;AACP,0BACE,oBAAC,WAAD,CAAa,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACIC,KAAD,IAAW;AACV,4BACE,oBAAC,IAAD;AACE,UAAA,WAAW,EAAEA,KAAK,CAACC,WADrB;AAEE,UAAA,IAAI,EAAED,KAAK,CAACE,IAFd;AAGE,UAAA,WAAW,EAAEF,KAAK,CAACG,WAHrB;AAIE,UAAA,WAAW,EAAEH,KAAK,CAACI,WAJrB;AAKE,UAAA,UAAU,EAAEJ,KAAK,CAACK,UALpB;AAME,UAAA,YAAY,EAAEL,KAAK,CAACM,YANtB;AAOE,UAAA,iBAAiB,EAAEN,KAAK,CAACO,iBAP3B;AAQE,UAAA,kBAAkB,EAAEP,KAAK,CAACQ,kBAR5B;AASE,UAAA,UAAU,EAAER,KAAK,CAACS,UATpB;AAUE,UAAA,YAAY,EAAET,KAAK,CAACU;AAVtB,WAWM,KAAKV,KAXX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WADF;AAeD,OAjBH,CADF;AAqBD;;AAvBqC,GAAxC;AAyBD,CA1BM;;AA4BP,MAAMW,YAAN,SAA2BvB,SAA3B,CAAqC;AACnCwB,EAAAA,WAAW,CAACZ,KAAD,EAAO;AAChB,UAAMA,KAAN;;AADgB,SAWlBa,iBAXkB,GAWE,YAAY;AAE9B,UAAI;AACF,cAAM;AAAEC,UAAAA,IAAI,EAAEZ;AAAR,YAAiB,MAAMb,GAAG,CAAC0B,GAAJ,CAAQ,cAAR,CAA7B;AACA,aAAKC,QAAL,CAAc;AACZd,UAAAA,IADY;AAEZO,UAAAA,UAAU,EAAE,IAFA;AAGZL,UAAAA,WAAW,EAAE;AAHD,SAAd;AAKD,OAPD,CAOE,OAAOa,KAAP,EAAc;AACd,aAAKD,QAAL,CAAc;AACZd,UAAAA,IAAI,EAAE,IADM;AAEZO,UAAAA,UAAU,EAAE,KAFA;AAGZL,UAAAA,WAAW,EAAE;AAHD,SAAd;AAKD;AACF,KA3BiB;;AAAA,SA6BlBH,WA7BkB,GA6BJ,OAAO;AAAEiB,MAAAA,KAAF;AAASC,MAAAA;AAAT,KAAP,KAAqC;AACjD,UAAI;AACF,cAAM;AAAEC,UAAAA;AAAF,YAAc,KAAKpB,KAAzB;AAEAT,QAAAA,QAAQ,CAAC8B,IAAT,GAAgBC,0BAAhB,CAA2C,kBAA3C,EAA+D,UAA/D,EAA2EC,IAA3E,CAAgFrB,IAAI,IAAI;AACtF,iBAAOA,IAAI,CAACsB,UAAL,GAAkBD,IAAlB,CAAuBE,OAAO,IAAI;AACvC;AACA,kBAAMC,KAAK,GAAGrC,GAAG,CAACsC,IAAJ,CAAS,cAAT,EAAyBF,OAAzB,CAAd;AACAG,YAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBH,KAAzB;AACD,WAJM,CAAP;AAKD,SAND,EAMGH,IANH,CAMQ,MAAM;AACZ;AACA,iBAAOhC,QAAQ,CAAC8B,IAAT,GAAgBS,OAAhB,EAAP;AACD,SATD,EASGP,IATH,CASQ,MAAM;AACZQ,UAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuB,UAAvB;AACD,SAXD;AAeA;;;;;;;AAOD,OAzBD,CAyBE,OAAOhB,KAAP,EAAc;AACd,aAAKD,QAAL,CAAc;AACZP,UAAAA,UAAU,EAAE,KADA;AAEZP,UAAAA,IAAI,EAAE,IAFM;AAGZG,UAAAA,UAAU,EAAE;AAHA,SAAd;AAKD;AACF,KA9DiB;;AAAA,SAgElBE,iBAhEkB,GAgEE,MAAO2B,UAAP,IAAsB;AACxC,UAAI;AACF,cAAM;AAAEd,UAAAA;AAAF,YAAc,KAAKpB,KAAzB;AAEA;;;;;AAIA,aAAKgB,QAAL,CAAc;AACZP,UAAAA,UAAU,EAAE,IADA;AAEZP,UAAAA,IAAI,EAAEA,IAAI,CAACA;AAFC,SAAd;AAIAkB,QAAAA,OAAO,CAACe,IAAR,CAAa,GAAb;AACD,OAZD,CAYE,OAAOlB,KAAP,EAAc;AACd,aAAKD,QAAL,CAAc;AACZP,UAAAA,UAAU,EAAE,KADA;AAEZP,UAAAA,IAAI,EAAE,IAFM;AAGZG,UAAAA,UAAU,EAAE;AAHA,SAAd;AAKD;AACF,KApFiB;;AAAA,SAsFlBG,kBAtFkB,GAsFG,MAAO0B,UAAP,IAAsB;AACzC,UAAI;AACF,cAAM;AAAEd,UAAAA;AAAF,YAAc,KAAKpB,KAAzB;AACA,YAAIoC,QAAQ,GAAGF,UAAU,CAACG,eAAX,GAA6BD,QAA5C;AACA,cAAMlC,IAAI,GAAG,MAAMT,KAAK,CAACkC,IAAN,CACjB,wCADiB,EAEhB,WAAUS,QAAS,EAFH,EAGjB;AAAEE,UAAAA,OAAO,EAAE;AAAC,4BAAgB;AAAjB;AAAX,SAHiB,CAAnB;AAKA,aAAKtB,QAAL,CAAc;AACZP,UAAAA,UAAU,EAAE,IADA;AAEZP,UAAAA;AAFY,SAAd;AAIAkB,QAAAA,OAAO,CAACe,IAAR,CAAa,GAAb;AACD,OAbD,CAaE,OAAOlB,KAAP,EAAc;AACd,aAAKD,QAAL,CAAc;AACZP,UAAAA,UAAU,EAAE,KADA;AAEZP,UAAAA,IAAI,EAAE,IAFM;AAGZG,UAAAA,UAAU,EAAE;AAHA,SAAd;AAKD;AACF,KA3GiB;;AAAA,SA6GlBC,YA7GkB,GA6GH,OAAO;AAAEY,MAAAA,KAAF;AAASC,MAAAA,cAAT;AAAyBoB,MAAAA,IAAzB;AAA+BC,MAAAA;AAA/B,KAAP,KAAiE;AAC9E,UAAI;AACF,cAAM;AAAEpB,UAAAA;AAAF,YAAc,KAAKpB,KAAzB;;AACA,YAAGmB,cAAc,KAAKqB,oBAAnB,IAA2CrB,cAAc,CAACsB,MAAf,GAAwB,CAAtE,EAAwE;AACtE,eAAKzB,QAAL,CAAc;AAAEb,YAAAA,WAAW,EAAE;AAAf,WAAd;AACA;AACD;;AACD,cAAM;AAAEW,UAAAA,IAAI,EAAEZ;AAAR,YAAiB,MAAMb,GAAG,CAACsC,IAAJ,CAAS,cAAT,EAAyB;AAAET,UAAAA,KAAF;AAASC,UAAAA,cAAT;AAAyBoB,UAAAA;AAAzB,SAAzB,CAA7B;AACA,aAAKvB,QAAL,CAAc;AACZP,UAAAA,UAAU,EAAE,IADA;AAEZP,UAAAA;AAFY,SAAd;AAIAkB,QAAAA,OAAO,CAACe,IAAR,CAAa,GAAb;AACD,OAZD,CAYE,OAAOlB,KAAP,EAAc;AACd,aAAKD,QAAL,CAAc;AACZP,UAAAA,UAAU,EAAE,KADA;AAEZP,UAAAA,IAAI,EAAE,IAFM;AAGZG,UAAAA,UAAU,EAAE;AAHA,SAAd;AAKD;AACF,KAjIiB;;AAAA,SAmIlBK,YAnIkB,GAmIH,YAAY;AACzB,UAAI;AACF,cAAM;AAAEU,UAAAA;AAAF,YAAc,KAAKpB,KAAzB;AACA,cAAMX,GAAG,CAAC0B,GAAJ,CAAQ,cAAR,CAAN;AACA,aAAKC,QAAL,CAAc;AACZP,UAAAA,UAAU,EAAE,KADA;AAEZP,UAAAA,IAAI,EAAE;AAFM,SAAd;AAIAkB,QAAAA,OAAO,CAACe,IAAR,CAAa,QAAb;AACD,OARD,CAQE,OAAOlB,KAAP,EAAc;AACdW,QAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;AACD;AACF,KA/IiB;;AAEhB,SAAKa,KAAL,GAAa;AACXjC,MAAAA,UAAU,EAAE,KADD;AAEXP,MAAAA,IAAI,EAAE,IAFK;AAGXE,MAAAA,WAAW,EAAE,IAHF;AAIXC,MAAAA,UAAU,EAAE,EAJD;AAKXsC,MAAAA,YAAY,EAAE;AALH,KAAb;AAOD;;AAwID5C,EAAAA,MAAM,GAAG;AACP,UAAM;AAAE6C,MAAAA;AAAF,QAAe,KAAK5C,KAA1B;AACA,UAAM;AAAES,MAAAA,UAAF;AAAcP,MAAAA,IAAd;AAAoBG,MAAAA,UAApB;AAAgCD,MAAAA,WAAhC;AAA6CD,MAAAA;AAA7C,QAA6D,KAAKuC,KAAxE;AACA,wBACE,oBAAC,WAAD,CAAa,QAAb;AACE,MAAA,KAAK,EAAE;AACLjC,QAAAA,UADK;AAELP,QAAAA,IAFK;AAGLE,QAAAA,WAHK;AAILC,QAAAA,UAJK;AAKLF,QAAAA,WALK;AAMLF,QAAAA,WAAW,EAAE,KAAKA,WANb;AAOLM,QAAAA,iBAAiB,EAAE,KAAKA,iBAPnB;AAQLC,QAAAA,kBAAkB,EAAE,KAAKA,kBARpB;AASLE,QAAAA,YAAY,EAAE,KAAKA,YATd;AAULJ,QAAAA,YAAY,EAAE,KAAKA;AAVd,OADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAcGsC,QAdH,CADF;AAkBD;;AAvKkC;;AA0KrC,eAAetD,UAAU,CAACqB,YAAD,CAAzB","sourcesContent":["import React, { Component } from \"react\";\nimport api from \"../services/apiClient\";\nimport { withRouter } from \"react-router-dom\";\nimport firebase from '../services/firebase'\nimport apiClient from \"../services/apiClient\";\nimport axios from \"axios\";\n\nexport const AuthContext = React.createContext();\n\nexport const withAuth = (Comp) => {\n  return class WithAuth extends Component {\n    render() {\n      return (\n        <AuthContext.Consumer>\n          {(props) => {\n            return (\n              <Comp\n                handleLogin={props.handleLogin}\n                user={props.user}\n                signUpError={props.signUpError}\n                authLoading={props.authLoading}\n                loginError={props.loginError}\n                handleSignUp={props.handleSignUp}\n                handleGoogleLogin={props.handleGoogleLogin}\n                handleGoogleSignup={props.handleGoogleSignup}\n                isLoggedIn={props.isLoggedIn}\n                handleLogout={props.handleLogout}\n                {...this.props}\n              />\n            );\n          }}\n        </AuthContext.Consumer>\n      );\n    }\n  };\n};\n\nclass AuthProvider extends Component {\n  constructor(props){\n    super(props)\n    this.state = {\n      isLoggedIn: false,\n      user: null,\n      authLoading: true,\n      loginError: \"\",\n      firebaseUser: \"\"\n    };\n  }\n\n  componentDidMount = async () => {\n\n    try {\n      const { data: user } = await api.get('/auth/whoami')\n      this.setState({\n        user,\n        isLoggedIn: true,\n        authLoading: false\n      })\n    } catch (error) {\n      this.setState({\n        user: null,\n        isLoggedIn: false,\n        authLoading: false\n      })\n    }\n  }\n\n  handleLogin = async ({ email, hashedPassword }) => {\n    try {\n      const { history } = this.props\n\n      firebase.auth().signInWithEmailAndPassword('user@example.com', 'password').then(user => {\n        return user.getIdToken().then(idToken => {\n          // const csrfToken = getCookie('csrfToken')\n          const token = api.post('/tokensignin', idToken)\n          console.log(77777777777, token)\n        });\n      }).then(() => {\n        // A page redirect would suffice as the persistence is set to NONE.\n        return firebase.auth().signOut();\n      }).then(() => {\n        window.location.assign('/profile');\n      });\n\n\n\n      /*\n      // const { data: user } = await api.post('/auth/login', { email, hashedPassword })\n      this.setState({\n        isLoggedIn: true,\n        user,\n      })      \n      history.push('/') */\n    } catch (error) {\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n        loginError: \"Incorrect user or password\"\n      })\n    }\n  }\n\n  handleGoogleLogin = async (googleUser) => {\n    try {\n      const { history } = this.props\n\n      /*\n      var id_token = googleUser.getAuthResponse().id_token;\n      const { data: user } = await axios.post('http://localhost:3005/auth/tokensignin', `idtoken=${id_token}`, { headers: {'Content-Type': 'application/x-www-form-urlencoded'}})\n      */\n      this.setState({\n        isLoggedIn: true,\n        user: user.user,\n      })\n      history.push('/')      \n    } catch (error) {\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n        loginError: \"User not exists\"\n      })\n    }\n  }\n\n  handleGoogleSignup = async (googleUser) => {\n    try {\n      const { history } = this.props\n      var id_token = googleUser.getAuthResponse().id_token;\n      const user = await axios.post(\n        'http://localhost:3005/auth/tokensignup',\n        `idtoken=${id_token}`,\n        { headers: {'Content-Type': 'application/x-www-form-urlencoded'}}\n        )\n      this.setState({\n        isLoggedIn: true,\n        user,\n      })\n      history.push('/')      \n    } catch (error) {\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n        loginError: \"Error on signup\"\n      })\n    }\n  }\n\n  handleSignUp = async ({ email, hashedPassword, name, confirmationPassword }) => {\n    try {\n      const { history } = this.props\n      if(hashedPassword !== confirmationPassword || hashedPassword.lenght < 6){\n        this.setState({ signUpError: 'Incorrect passwords or weak password' })\n        return\n      }\n      const { data: user } = await api.post('/auth/signup', { email, hashedPassword, name })\n      this.setState({\n        isLoggedIn: true,\n        user,\n      })\n      history.push('/')\n    } catch (error) {\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n        loginError: \"Error on signup\"\n      })\n    }\n  }\n\n  handleLogout = async () => {\n    try {\n      const { history } = this.props\n      await api.get('/auth/logout')\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n      })  \n      history.push('/login')\n    } catch (error) {\n      console.log('Error on logout')      \n    }\n  };\n\n  render() {\n    const { children } = this.props;\n    const { isLoggedIn, user, loginError, authLoading, signUpError } = this.state;\n    return (\n      <AuthContext.Provider\n        value={{\n          isLoggedIn,\n          user,\n          authLoading,\n          loginError,\n          signUpError,\n          handleLogin: this.handleLogin,\n          handleGoogleLogin: this.handleGoogleLogin,\n          handleGoogleSignup: this.handleGoogleSignup,\n          handleLogout: this.handleLogout,\n          handleSignUp: this.handleSignUp\n        }}\n      >\n        {children}\n      </AuthContext.Provider>\n    );\n  }\n}\n\nexport default withRouter(AuthProvider);"]},"metadata":{},"sourceType":"module"}