{"ast":null,"code":"import _regeneratorRuntime from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import MATCH_COMPONENTS from'../../utils/componentsMatching';import{withData}from'../../contexts/dataContext';import OptionsBar from'../droy/OptionsBar';import ModalChangeInfo from'../droy/ModalChangeInfo';import{uuid}from'uuidv4';import'../../styles/user-componentBase.css';import firebase from'../../services/firebase';var UserComponentBase=/*#__PURE__*/function(_Component){_inherits(UserComponentBase,_Component);var _super=_createSuper(UserComponentBase);function UserComponentBase(props){var _this;_classCallCheck(this,UserComponentBase);_this=_super.call(this,props);_this.handleOpenModal=function(e){_this.setState({openChangeModal:true,attributeSelected:e.target.attributes['data-id'].value});};_this.handleCloseModal=function(){_this.setState({openChangeModal:false,attributeSelected:''});};_this.changeImage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _this$props,projectId,code,saveComponentInfoToContext,attr,file,randomFileName,storageRef,downloadUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props=_this.props,projectId=_this$props.projectId,code=_this$props.code,saveComponentInfoToContext=_this$props.saveComponentInfoToContext;attr=e.target.attributes['data-id'].value;file=e.target.files[0];if(!(file.size>20000)){_context.next=6;break;}alert('Imagen demasiado grande.');return _context.abrupt(\"return\");case 6:randomFileName=uuid();storageRef=firebase.storage().ref(\"/\".concat(firebase.auth().currentUser.uid,\"/\").concat(projectId,\"/\").concat(randomFileName));_context.next=10;return storageRef.put(file);case 10:_context.next=12;return storageRef.getDownloadURL();case 12:downloadUrl=_context.sent;saveComponentInfoToContext(code,attr,downloadUrl);case 14:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.state={optionsModal:false,attributeSelected:''};return _this;}_createClass(UserComponentBase,[{key:\"render\",value:function render(){var _this$props2=this.props,mode=_this$props2.mode,moveComponent=_this$props2.moveComponent,code=_this$props2.code,deleteComponent=_this$props2.deleteComponent,saveComponentInfoToContext=_this$props2.saveComponentInfoToContext,userLayoutObj=_this$props2.userLayoutObj;var _this$state=this.state,attributeSelected=_this$state.attributeSelected,openChangeModal=_this$state.openChangeModal;var UserComp=MATCH_COMPONENTS[code];var componentInfo=userLayoutObj.filter(function(c){return c.code===code;})[0].info;var componentProps={};if(mode==='edit'){componentProps['openChangeModal']=this.handleOpenModal;componentProps['changeImage']=this.changeImage;}componentProps['info']=componentInfo;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(UserComp,componentProps,mode===\"edit\"&&/*#__PURE__*/React.createElement(OptionsBar,{code:code,deleteComponent:deleteComponent,moveComponent:moveComponent}),mode===\"edit\"&&openChangeModal&&/*#__PURE__*/React.createElement(ModalChangeInfo,{oldText:componentInfo[attributeSelected],code:code,attributeSelected:attributeSelected,saveComponentInfoToContext:saveComponentInfoToContext,onClose:this.handleCloseModal})));}}]);return UserComponentBase;}(Component);export default withData(UserComponentBase);","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/components/droy/UserComponentBase.js"],"names":["React","Component","MATCH_COMPONENTS","withData","OptionsBar","ModalChangeInfo","uuid","firebase","UserComponentBase","props","handleOpenModal","e","setState","openChangeModal","attributeSelected","target","attributes","value","handleCloseModal","changeImage","projectId","code","saveComponentInfoToContext","attr","file","files","size","alert","randomFileName","storageRef","storage","ref","auth","currentUser","uid","put","getDownloadURL","downloadUrl","state","optionsModal","mode","moveComponent","deleteComponent","userLayoutObj","UserComp","componentInfo","filter","c","info","componentProps"],"mappings":"m4BAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,MAAOC,CAAAA,gBAAP,KAA6B,gCAA7B,CAEA,OAASC,QAAT,KAAyB,4BAAzB,CACA,MAAOC,CAAAA,UAAP,KAAuB,oBAAvB,CACA,MAAOC,CAAAA,eAAP,KAA4B,yBAA5B,CACA,OAASC,IAAT,KAAqB,QAArB,CACA,MAAO,qCAAP,CACA,MAAOC,CAAAA,QAAP,KAAqB,yBAArB,C,GAEMC,CAAAA,iB,sHACJ,2BAAaC,KAAb,CAAoB,mDAClB,uBAAMA,KAAN,EADkB,MAQpBC,eARoB,CAQF,SAACC,CAAD,CAAM,CACtB,MAAKC,QAAL,CAAc,CACZC,eAAe,CAAE,IADL,CAEZC,iBAAiB,CAAEH,CAAC,CAACI,MAAF,CAASC,UAAT,CAAoB,SAApB,EAA+BC,KAFtC,CAAd,EAID,CAbmB,OAepBC,gBAfoB,CAeD,UAAK,CACtB,MAAKN,QAAL,CAAc,CACZC,eAAe,CAAE,KADL,CAEZC,iBAAiB,CAAE,EAFP,CAAd,EAID,CApBmB,OAsBpBK,WAtBoB,0FAsBN,iBAAMR,CAAN,wOAC4C,MAAKF,KADjD,CACJW,SADI,aACJA,SADI,CACOC,IADP,aACOA,IADP,CACaC,0BADb,aACaA,0BADb,CAENC,IAFM,CAECZ,CAAC,CAACI,MAAF,CAASC,UAAT,CAAoB,SAApB,EAA+BC,KAFhC,CAGNO,IAHM,CAGCb,CAAC,CAACI,MAAF,CAASU,KAAT,CAAe,CAAf,CAHD,MAITD,IAAI,CAACE,IAAL,CAAY,KAJH,0BAKVC,KAAK,CAAC,0BAAD,CAAL,CALU,wCAQNC,cARM,CAQWtB,IAAI,EARf,CASNuB,UATM,CASOtB,QAAQ,CAACuB,OAAT,GAAmBC,GAAnB,YAA2BxB,QAAQ,CAACyB,IAAT,GAAgBC,WAAhB,CAA4BC,GAAvD,aAA8Dd,SAA9D,aAA2EQ,cAA3E,EATP,wBAUNC,CAAAA,UAAU,CAACM,GAAX,CAAeX,IAAf,CAVM,gCAWcK,CAAAA,UAAU,CAACO,cAAX,EAXd,SAWNC,WAXM,eAYZf,0BAA0B,CAACD,IAAD,CAAOE,IAAP,CAAac,WAAb,CAA1B,CAZY,uDAtBM,+DAElB,MAAKC,KAAL,CAAa,CACXC,YAAY,CAAE,KADH,CAEXzB,iBAAiB,CAAE,EAFR,CAAb,CAFkB,aAMnB,C,qEA+BS,kBAC4F,KAAKL,KADjG,CACA+B,IADA,cACAA,IADA,CACMC,aADN,cACMA,aADN,CACsBpB,IADtB,cACsBA,IADtB,CAC4BqB,eAD5B,cAC4BA,eAD5B,CAC6CpB,0BAD7C,cAC6CA,0BAD7C,CACyEqB,aADzE,cACyEA,aADzE,iBAEuC,KAAKL,KAF5C,CAEAxB,iBAFA,aAEAA,iBAFA,CAEmBD,eAFnB,aAEmBA,eAFnB,CAGR,GAAM+B,CAAAA,QAAQ,CAAG1C,gBAAgB,CAACmB,IAAD,CAAjC,CACA,GAAMwB,CAAAA,aAAa,CAAGF,aAAa,CAACG,MAAd,CAAqB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAAC1B,IAAF,GAAWA,IAAf,EAAtB,EAA2C,CAA3C,EAA8C2B,IAApE,CACA,GAAMC,CAAAA,cAAc,CAAG,EAAvB,CACA,GAAGT,IAAI,GAAK,MAAZ,CAAmB,CACjBS,cAAc,CAAC,iBAAD,CAAd,CAAoC,KAAKvC,eAAzC,CACAuC,cAAc,CAAC,aAAD,CAAd,CAAgC,KAAK9B,WAArC,CACD,CACD8B,cAAc,CAAC,MAAD,CAAd,CAAyBJ,aAAzB,CACA,mBACE,4CACE,oBAAC,QAAD,CAAcI,cAAd,CACGT,IAAI,GAAK,MAAT,eAAmB,oBAAC,UAAD,EAAY,IAAI,CAAEnB,IAAlB,CAAwB,eAAe,CAAEqB,eAAzC,CAA0D,aAAa,CAAED,aAAzE,EADtB,CAEGD,IAAI,GAAK,MAAT,EAAmB3B,eAAnB,eAAsC,oBAAC,eAAD,EAAiB,OAAO,CAAEgC,aAAa,CAAC/B,iBAAD,CAAvC,CAA4D,IAAI,CAAEO,IAAlE,CAAwE,iBAAiB,CAAEP,iBAA3F,CAA8G,0BAA0B,CAAEQ,0BAA1I,CAAsK,OAAO,CAAE,KAAKJ,gBAApL,EAFzC,CADF,CADF,CAQD,C,+BAzD6BjB,S,EAgEhC,cAAeE,CAAAA,QAAQ,CAACK,iBAAD,CAAvB","sourcesContent":["import React, { Component } from 'react'\nimport MATCH_COMPONENTS from '../../utils/componentsMatching'\nimport PropTypes from 'prop-types'\nimport { withData } from '../../contexts/dataContext'\nimport OptionsBar from '../droy/OptionsBar'\nimport ModalChangeInfo from '../droy/ModalChangeInfo'\nimport { uuid } from 'uuidv4'\nimport '../../styles/user-componentBase.css'\nimport firebase from '../../services/firebase'\n\nclass UserComponentBase extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      optionsModal: false,\n      attributeSelected: '',\n    }\n  }\n\n  handleOpenModal = (e) =>{\n    this.setState({\n      openChangeModal: true,\n      attributeSelected: e.target.attributes['data-id'].value\n    })\n  }\n\n  handleCloseModal = () =>{\n    this.setState({\n      openChangeModal: false,\n      attributeSelected: ''\n    })\n  }\n\n  changeImage = async e => {\n    const { projectId, code, saveComponentInfoToContext } = this.props\n    const attr = e.target.attributes['data-id'].value\n    const file = e.target.files[0]\n    if(file.size > 20000){\n      alert('Imagen demasiado grande.')\n      return\n    }\n    const randomFileName = uuid()\n    const storageRef = firebase.storage().ref(`/${firebase.auth().currentUser.uid}/${projectId}/${randomFileName}`)\n    await storageRef.put(file)\n    const downloadUrl = await storageRef.getDownloadURL()\n    saveComponentInfoToContext(code, attr, downloadUrl)\n  }\n\n  render () {\n    const { mode, moveComponent , code, deleteComponent, saveComponentInfoToContext, userLayoutObj  } = this.props\n    const { attributeSelected, openChangeModal } = this.state\n    const UserComp = MATCH_COMPONENTS[code]\n    const componentInfo = userLayoutObj.filter(c => c.code === code)[0].info\n    const componentProps = {}\n    if(mode === 'edit'){\n      componentProps['openChangeModal'] = this.handleOpenModal\n      componentProps['changeImage'] = this.changeImage\n    }\n    componentProps['info'] = componentInfo \n    return (\n      <div>\n        <UserComp {...componentProps}>\n          {mode === \"edit\" && <OptionsBar code={code} deleteComponent={deleteComponent} moveComponent={moveComponent}/>}\n          {mode === \"edit\" && openChangeModal && <ModalChangeInfo oldText={componentInfo[attributeSelected]} code={code} attributeSelected={attributeSelected} saveComponentInfoToContext={saveComponentInfoToContext} onClose={this.handleCloseModal}/>}\n        </UserComp>\n      </div>\n    )\n  }\n}\n\nUserComponentBase.propTypes = {\n  code: PropTypes.string\n}\n\nexport default withData(UserComponentBase)\n"]},"metadata":{},"sourceType":"module"}