{"ast":null,"code":"var _jsxFileName = \"/home/ironhacker/Documents/M3/droy/src/contexts/authContext.js\";\nimport React, { Component } from \"react\";\nimport api from \"../services/apiClient\";\nexport const AuthContext = React.createContext();\nexport const withAuth = Comp => {\n  return class WithAuth extends Component {\n    render() {\n      return /*#__PURE__*/React.createElement(AuthContext.Consumer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 11,\n          columnNumber: 9\n        }\n      }, ({\n        handleLogin,\n        user,\n        isLoggedIn,\n        handleLogout\n      }) => {\n        return /*#__PURE__*/React.createElement(Comp, Object.assign({\n          logIn: handleLogin,\n          user: user,\n          isLoggedIn: isLoggedIn,\n          onLogout: handleLogout\n        }, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 14,\n            columnNumber: 15\n          }\n        }));\n      });\n    }\n\n  };\n};\n\nclass AuthProvider extends Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = async () => {\n      try {\n        const user = await api.get('/auth/whoami');\n        this.setState({\n          isLoading: false,\n          isLoggedIn: true,\n          user\n        });\n      } catch (error) {\n        this.setState({\n          isLoading: false,\n          isLoggedIn: false,\n          user: null\n        });\n      }\n    };\n\n    this.handleLogin = ({\n      username,\n      hashedPassword\n    }) => {\n      try {\n        const {\n          data: user\n        } = api.get('/auth/login', {\n          username,\n          hashedPassword\n        });\n        this.setState({\n          isLoggedIn: true,\n          user\n        });\n      } catch (error) {\n        this.setState({\n          isLoggedIn: false,\n          user: null\n        });\n      }\n    };\n\n    this.handleLogout = () => {\n      try {\n        api.get('/auth/logout');\n        this.setState({\n          isLoggedIn: false,\n          user: null\n        });\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    this.state = {\n      isLoggedIn: false,\n      user: null,\n      isLoading: true\n    };\n  }\n\n  render() {\n    const {\n      children\n    } = this.props;\n    const {\n      isLoggedIn,\n      user\n    } = this.state;\n    return /*#__PURE__*/React.createElement(AuthContext.Provider, {\n      value: {\n        isLoggedIn,\n        user,\n        handleLogin: this.handleLogin,\n        handleLogout: this.handleLogout\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 7\n      }\n    }, children);\n  }\n\n}\n\nexport default AuthProvider;","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/contexts/authContext.js"],"names":["React","Component","api","AuthContext","createContext","withAuth","Comp","WithAuth","render","handleLogin","user","isLoggedIn","handleLogout","props","AuthProvider","constructor","componentDidMount","get","setState","isLoading","error","username","hashedPassword","data","console","log","state","children"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n\nimport api from \"../services/apiClient\";\n\nexport const AuthContext = React.createContext();\n\nexport const withAuth = (Comp) => {\n  return class WithAuth extends Component {\n    render() {\n      return (\n        <AuthContext.Consumer>\n          {({ handleLogin, user, isLoggedIn, handleLogout }) => {\n            return (\n              <Comp\n                logIn={handleLogin}\n                user={user}\n                isLoggedIn={isLoggedIn}\n                onLogout={handleLogout}\n                {...this.props}\n              />\n            );\n          }}\n        </AuthContext.Consumer>\n      );\n    }\n  };\n};\n\nclass AuthProvider extends Component {\n  constructor(props){\n    super(props)\n    this.state = {\n      isLoggedIn: false,\n      user: null,\n      isLoading: true,\n    };\n  }\n\n  componentDidMount = async () => {\n    try {\n      const user = await api.get('/auth/whoami')\n      this.setState({\n        isLoading: false,\n        isLoggedIn: true,\n        user,\n      })\n      \n    } catch (error) {\n      this.setState({\n        isLoading: false,\n        isLoggedIn: false,\n        user: null,\n      })      \n    }\n  }\n\n  handleLogin = ({ username, hashedPassword }) => {\n    try {\n      const { data: user } = api.get('/auth/login', { username, hashedPassword })\n      this.setState({\n        isLoggedIn: true,\n        user,\n      });\n    } catch (error) {\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n      })      \n    }\n  };\n\n  handleLogout = () => {\n    try {\n      api.get('/auth/logout')\n      this.setState({\n        isLoggedIn: false,\n        user: null,\n      });\n      \n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  render() {\n    const { children } = this.props;\n    const { isLoggedIn, user } = this.state;\n    return (\n      <AuthContext.Provider\n        value={{\n          isLoggedIn,\n          user,\n          handleLogin: this.handleLogin,\n          handleLogout: this.handleLogout,\n        }}\n      >\n        {children}\n      </AuthContext.Provider>\n    );\n  }\n}\n\nexport default AuthProvider;"]},"metadata":{},"sourceType":"module"}