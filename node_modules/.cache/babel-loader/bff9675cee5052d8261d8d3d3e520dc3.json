{"ast":null,"code":"import _regeneratorRuntime from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import api from'../services/apiClient';var DataContext=React.createContext();// Consumer Wrapper\nexport var withData=function withData(Comp){return/*#__PURE__*/function(_Component){_inherits(WithData,_Component);var _super=_createSuper(WithData);function WithData(){_classCallCheck(this,WithData);return _super.apply(this,arguments);}_createClass(WithData,[{key:\"render\",value:function render(){var _this=this;return/*#__PURE__*/React.createElement(DataContext.Consumer,null,function(props){return/*#__PURE__*/React.createElement(Comp,Object.assign({},_this.props,props));});}}]);return WithData;}(Component);};// Provider def\nvar DataProvider=/*#__PURE__*/function(_Component2){_inherits(DataProvider,_Component2);var _super2=_createSuper(DataProvider);function DataProvider(props){var _this2;_classCallCheck(this,DataProvider);_this2=_super2.call(this,props);_this2.switchMode=function(){var mode=_this2.state.mode;_this2.setState({mode:mode==='edit'?'view':'edit'});};_this2.deleteComponent=function(elementCode){var stateCopy=_objectSpread({},_this2.state);var newUserLayoutObj=stateCopy.userLayoutObj;var fromIndex=0;for(var i=0;i<newUserLayoutObj.length;i++){var c=newUserLayoutObj[i];if(c.code===elementCode){fromIndex=i;break;}}newUserLayoutObj.splice(fromIndex,1);_this2.setState({userLayoutObj:newUserLayoutObj});};_this2.moveComponent=function(elementCode,direction){var stateCopy=_objectSpread({},_this2.state);var newUserLayoutObj=stateCopy.userLayoutObj;var fromIndex=0;var element;for(var i=0;i<newUserLayoutObj.length;i++){var c=newUserLayoutObj[i];if(c.code===elementCode){element=c;fromIndex=i;break;}}newUserLayoutObj.splice(fromIndex,1);if(direction==='down')newUserLayoutObj.splice(fromIndex+1,0,element);else if(direction==='up')newUserLayoutObj.splice(fromIndex-1,0,element);_this2.setState({userLayoutObj:newUserLayoutObj});};_this2.save=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(projectId){var userLayoutObj;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_this2.setState({savingStep:'Saving...'});userLayoutObj=_this2.state.userLayoutObj;_context.next=5;return api.put(\"/projects/\".concat(projectId),{componentsConfiguration:userLayoutObj});case 5:setTimeout(function(){_this2.setState({savingStep:'OK'});setTimeout(function(){_this2.setState({savingStep:'Save'});},500);},500);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);alert(\"Error al guardar.\");case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function(_x){return _ref.apply(this,arguments);};}();_this2.saveComponentInfoToContext=function(componentCode,componentAttr,attrContent){var stateCopy=_objectSpread({},_this2.state);var newUserLayoutObj=stateCopy.userLayoutObj;var saveTo=newUserLayoutObj.find(function(userObject){return userObject.code===componentCode;});saveTo.info[componentAttr]=attrContent;_this2.setState({userLayoutObj:newUserLayoutObj});};_this2.addComponent=function(componentCode,defaultInfo){var stateCopy=_objectSpread({},_this2.state);stateCopy.userLayoutObj.push({code:componentCode,info:defaultInfo});_this2.setState({userLayoutObj:stateCopy.userLayoutObj});};_this2.getProjectInfo=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(projectId){var _yield$api$get,_yield$api$get$data,componentsConfiguration,style,_id;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return api.get(\"/projects/\".concat(projectId));case 3:_yield$api$get=_context2.sent;_yield$api$get$data=_yield$api$get.data;componentsConfiguration=_yield$api$get$data.componentsConfiguration;style=_yield$api$get$data.style;_id=_yield$api$get$data._id;_this2.setState({projectId:_id,userLayoutObj:componentsConfiguration,projectStyle:style});_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);_this2.setState({dataError:\"Unable to get your project data\"});case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this2.state={mode:'edit',userLayoutObj:[],projectStyle:\"\",projectId:\"\",dataError:\"\",savingStep:'Save'};return _this2;}/* SWITCH MODES */_createClass(DataProvider,[{key:\"render\",value:function render(){var children=this.props.children;return/*#__PURE__*/React.createElement(DataContext.Provider,{value:_objectSpread({saveComponentInfoToContext:this.saveComponentInfoToContext,getProjectInfo:this.getProjectInfo,switchMode:this.switchMode,moveComponent:this.moveComponent,addComponent:this.addComponent,deleteComponent:this.deleteComponent,save:this.save},this.state)},children);}}]);return DataProvider;}(Component);export default DataProvider;","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/contexts/dataContext.js"],"names":["React","Component","api","DataContext","createContext","withData","Comp","props","DataProvider","switchMode","mode","state","setState","deleteComponent","elementCode","stateCopy","newUserLayoutObj","userLayoutObj","fromIndex","i","length","c","code","splice","moveComponent","direction","element","save","projectId","savingStep","put","componentsConfiguration","setTimeout","alert","saveComponentInfoToContext","componentCode","componentAttr","attrContent","saveTo","find","userObject","info","addComponent","defaultInfo","push","getProjectInfo","get","data","style","_id","projectStyle","dataError","children"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport api from '../services/apiClient'\n\nconst DataContext = React.createContext()\n\n// Consumer Wrapper\nexport const withData = (Comp) => {\n  return class WithData extends Component {\n    render() {\n      return (\n        <DataContext.Consumer>\n          {(props) => <Comp {...this.props} {...props} />}\n        </DataContext.Consumer>\n      )\n    }\n  }\n}\n\n// Provider def\nclass DataProvider extends Component {\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      mode: 'edit',\n      userLayoutObj: [],\n      projectStyle: \"\",\n      projectId: \"\",\n      dataError: \"\",\n      savingStep: 'Save',\n    }\n  }\n\n  /* SWITCH MODES */\n  switchMode = () => {\n    const { mode } = this.state\n    this.setState({ mode: mode === 'edit' ? 'view' : 'edit' })\n  }\n\n  deleteComponent = (elementCode) => {\n    const stateCopy = { ...this.state }\n    const { userLayoutObj: newUserLayoutObj } = stateCopy\n    let fromIndex = 0;\n    for (let i = 0; i < newUserLayoutObj.length; i++) {\n      const c = newUserLayoutObj[i];\n      if (c.code === elementCode) {\n        fromIndex = i; break\n      }\n    }\n    newUserLayoutObj.splice(fromIndex, 1)\n    this.setState({ userLayoutObj: newUserLayoutObj })\n  }\n\n  moveComponent = (elementCode, direction) => {\n    const stateCopy = { ...this.state }\n    const { userLayoutObj: newUserLayoutObj } = stateCopy\n    let fromIndex = 0; let element\n    for (let i = 0; i < newUserLayoutObj.length; i++) {\n      const c = newUserLayoutObj[i];\n      if (c.code === elementCode) {\n        element = c; fromIndex = i; break\n      }\n    }\n    newUserLayoutObj.splice(fromIndex, 1)\n    if (direction === 'down') newUserLayoutObj.splice(fromIndex + 1, 0, element)\n    else if (direction === 'up') newUserLayoutObj.splice(fromIndex - 1, 0, element)\n    this.setState({ userLayoutObj: newUserLayoutObj })\n  }\n\n\n  save = async (projectId) => {\n    try {\n      this.setState({ savingStep: 'Saving...' })\n      const { userLayoutObj } = this.state\n      await api.put(`/projects/${projectId}`, { componentsConfiguration: userLayoutObj })\n      setTimeout(() => {\n        this.setState({ savingStep: 'OK' })\n        setTimeout(() => { this.setState({ savingStep: 'Save' }) }, 500);\n      }, 500);\n    } catch (error) {\n      alert(\"Error al guardar.\")\n    }   \n  }\n\n  saveComponentInfoToContext = (componentCode, componentAttr, attrContent) => {\n    const stateCopy = {...this.state}\n    const { userLayoutObj: newUserLayoutObj } = stateCopy\n    const saveTo = newUserLayoutObj.find(userObject => userObject.code === componentCode)\n    saveTo.info[componentAttr] = attrContent\n    this.setState({\n      userLayoutObj: newUserLayoutObj\n    })\n  };\n\n  addComponent = (componentCode, defaultInfo) => {\n    const stateCopy = { ...this.state }\n    stateCopy.userLayoutObj.push({\n      code: componentCode,\n      info: defaultInfo\n    })\n    this.setState({\n      userLayoutObj: stateCopy.userLayoutObj\n    })\n  }\n\n  getProjectInfo = async (projectId) => {\n    try {\n      const { data: { componentsConfiguration, style, _id } } = await api.get(`/projects/${projectId}`)\n      this.setState({\n        projectId: _id,\n        userLayoutObj: componentsConfiguration,\n        projectStyle: style,\n      })\n    } catch (error) {\n      this.setState({ dataError: \"Unable to get your project data\" })\n    }\n  }\n\n  render () {\n    const { children } = this.props\n\n    return (\n      <DataContext.Provider value={{\n        saveComponentInfoToContext: this.saveComponentInfoToContext,\n        getProjectInfo: this.getProjectInfo,\n        switchMode: this.switchMode,\n        moveComponent: this.moveComponent,\n        addComponent: this.addComponent,\n        deleteComponent: this.deleteComponent,\n        save: this.save,\n        ...this.state\n\n      }}>\n        {children}\n      </DataContext.Provider>\n    )\n  }\n}\n\nDataProvider.propTypes = {\n  children: PropTypes.node\n}\n\nexport default DataProvider\n"]},"metadata":{},"sourceType":"module"}