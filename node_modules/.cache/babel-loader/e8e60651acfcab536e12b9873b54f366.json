{"ast":null,"code":"import _regeneratorRuntime from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import MATCH_COMPONENTS from'../../utils/componentsMatching';import{withData}from'../../contexts/dataContext';import OptionsBar from'../droy/OptionsBar';import ModalChangeInfo from'../droy/ModalChangeInfo';import{uuid}from'uuidv4';import'../../styles/user-componentBase.css';import firebase from'../../services/firebase';import alias from'../../utils/alias';/* Provides all the funcions to manage all component content and style */var UserComponentBase=/*#__PURE__*/function(_Component){_inherits(UserComponentBase,_Component);var _super=_createSuper(UserComponentBase);function UserComponentBase(props){var _this;_classCallCheck(this,UserComponentBase);_this=_super.call(this,props);_this.handleOpenModal=function(e){var _this$props=_this.props,userLayoutObj=_this$props.userLayoutObj,code=_this$props.code;var attrCode=e.target.attributes['data-id'].value;var attributeInfo=alias.findByCode(userLayoutObj,code);_this.setState({openChangeModal:true,attributeSelected:attrCode,attributeSelectedInfo:attributeInfo.info[attrCode],attributeSelectedStyle:attributeInfo.style[attrCode]});};_this.handleCloseModal=function(){_this.setState({openChangeModal:false,attributeSelected:'',attributeSelectedInfo:'',attributeSelectedStyle:''});};_this.changeImage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _this$props2,projectId,code,saveComponentInfoToContext,attr,file,randomFileName,storageRef,downloadUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props2=_this.props,projectId=_this$props2.projectId,code=_this$props2.code,saveComponentInfoToContext=_this$props2.saveComponentInfoToContext;attr=e.target.attributes['data-id'].value;file=e.target.files[0];if(!(file.size>70000)){_context.next=7;break;}alert('Imagen demasiado grande.');_context.next=15;break;case 7:randomFileName=uuid();storageRef=firebase.storage().ref(\"/\".concat(firebase.auth().currentUser.uid,\"/\").concat(projectId,\"/\").concat(randomFileName));_context.next=11;return storageRef.put(file);case 11:_context.next=13;return storageRef.getDownloadURL();case 13:downloadUrl=_context.sent;saveComponentInfoToContext(code,attr,{src:downloadUrl});case 15:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.addLink=function(){var _this$props3=_this.props,code=_this$props3.code,saveComponentInfoToContext=_this$props3.saveComponentInfoToContext,userLayoutObj=_this$props3.userLayoutObj;var targetComponentInfo=alias.findByCode(userLayoutObj,code).info;var linksIds=[];for(var key in targetComponentInfo){if(targetComponentInfo[key].type!=='link')continue;linksIds.push(parseInt(key.match(/\\d+$/)[0]));}if(linksIds.length>=5)return;var newAttr='';if(!linksIds.length)newAttr='link1';else newAttr=\"link\".concat(Math.max.apply(Math,linksIds)+1);// Cambiar link por default a pagina de quienes somos de Droy\nvar newInfo={style:{fontSize:'1rem',letterSpacing:'inherit'},type:'link',text:\"New link\",href:'http://www.google.es',toNewPage:true};saveComponentInfoToContext(code,newAttr,newInfo);};_this.deleteLink=function(e){var _this$props4=_this.props,code=_this$props4.code,saveComponentInfoToContext=_this$props4.saveComponentInfoToContext;var attributeSelected=_this.state.attributeSelected;saveComponentInfoToContext(code,attributeSelected,undefined);_this.handleCloseModal();};_this.changeInfo=function(info){var attributeSelected=_this.state.attributeSelected;var _this$props5=_this.props,code=_this$props5.code,saveComponentInfoToContext=_this$props5.saveComponentInfoToContext;saveComponentInfoToContext(code,attributeSelected,info);_this.handleCloseModal();};_this.changeColor=function(color){var _this$props6=_this.props,code=_this$props6.code,saveUserComponentStyleInfoToContext=_this$props6.saveUserComponentStyleInfoToContext;saveUserComponentStyleInfoToContext(code,{backgroundColor:color});};_this.changeHeight=function(height){var _this$props7=_this.props,code=_this$props7.code,saveUserComponentStyleInfoToContext=_this$props7.saveUserComponentStyleInfoToContext;saveUserComponentStyleInfoToContext(code,{height:height});};_this.changeBackgroundImage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var _this$props8,projectId,code,saveUserComponentStyleInfoToContext,file,randomFileName,storageRef,downloadUrl;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props8=_this.props,projectId=_this$props8.projectId,code=_this$props8.code,saveUserComponentStyleInfoToContext=_this$props8.saveUserComponentStyleInfoToContext;file=e.target.files[0];if(!(file.size>700000)){_context2.next=6;break;}alert('Imagen demasiado grande.');_context2.next=14;break;case 6:randomFileName=uuid();storageRef=firebase.storage().ref(\"/\".concat(firebase.auth().currentUser.uid,\"/\").concat(projectId,\"/\").concat(randomFileName));_context2.next=10;return storageRef.put(file);case 10:_context2.next=12;return storageRef.getDownloadURL();case 12:downloadUrl=_context2.sent;saveUserComponentStyleInfoToContext(code,{backgroundImage:\"url(\\\"\".concat(downloadUrl,\"\\\")\")});case 14:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.state={optionsModal:false,attributeSelected:'',attributeSelectedInfo:'',attributeSelectedStyle:''};return _this;}/* Opens the editor modal setting the target to the state */_createClass(UserComponentBase,[{key:\"render\",/* Gets the real React components and pass new funcionalities */value:function render(){var _this$props9=this.props,mode=_this$props9.mode,moveComponent=_this$props9.moveComponent,componentOptions=_this$props9.componentOptions,code=_this$props9.code,deleteComponent=_this$props9.deleteComponent,userLayoutObj=_this$props9.userLayoutObj;var _this$state=this.state,attributeSelected=_this$state.attributeSelected,openChangeModal=_this$state.openChangeModal,attributeSelectedInfo=_this$state.attributeSelectedInfo,attributeSelectedStyle=_this$state.attributeSelectedStyle;var UserComp=MATCH_COMPONENTS[code];var _alias$findByCode=alias.findByCode(userLayoutObj,code),componentInfo=_alias$findByCode.info,contentStyle=_alias$findByCode.style,userStyle=_alias$findByCode.componentUserOverrideStyle;var componentProps={};componentProps['info']=componentInfo;componentProps['contentStyle']=contentStyle;componentProps['userStyle']=userStyle;if(mode==='edit'){componentProps['openChangeModal']=this.handleOpenModal;componentProps['changeImage']=this.changeImage;}var optionsProps={};optionsProps['code']=code;optionsProps['deleteComponent']=deleteComponent;optionsProps['moveComponent']=moveComponent;optionsProps['componentStyle']=userStyle;if(componentOptions.includes('changeHeight'))optionsProps['changeHeight']=this.changeHeight;if(componentOptions.includes('addLinks'))optionsProps['addLink']=this.addLink;if(componentOptions.includes('backgroundColor'))optionsProps['changeColor']=this.changeColor;if(componentOptions.includes('backgroundImage'))optionsProps['changeBackgroundImage']=this.changeBackgroundImage;var modalProps={};modalProps['attributeSelected']=attributeSelected;modalProps['onClose']=this.handleCloseModal;modalProps['style']=attributeSelectedStyle;modalProps['deleteLink']=this.deleteLink;modalProps['changeInfo']=this.changeInfo;modalProps['info']=attributeSelectedInfo;modalProps['code']=code;return/*#__PURE__*/React.createElement(UserComp,Object.assign({},componentProps,{mode:mode}),mode===\"edit\"&&/*#__PURE__*/React.createElement(OptionsBar,optionsProps),openChangeModal&&/*#__PURE__*/React.createElement(ModalChangeInfo,modalProps));}}]);return UserComponentBase;}(Component);export default withData(UserComponentBase);","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/components/droy/UserComponentBase.js"],"names":["React","Component","MATCH_COMPONENTS","withData","OptionsBar","ModalChangeInfo","uuid","firebase","alias","UserComponentBase","props","handleOpenModal","e","userLayoutObj","code","attrCode","target","attributes","value","attributeInfo","findByCode","setState","openChangeModal","attributeSelected","attributeSelectedInfo","info","attributeSelectedStyle","style","handleCloseModal","changeImage","projectId","saveComponentInfoToContext","attr","file","files","size","alert","randomFileName","storageRef","storage","ref","auth","currentUser","uid","put","getDownloadURL","downloadUrl","src","addLink","targetComponentInfo","linksIds","key","type","push","parseInt","match","length","newAttr","Math","max","newInfo","fontSize","letterSpacing","text","href","toNewPage","deleteLink","state","undefined","changeInfo","changeColor","color","saveUserComponentStyleInfoToContext","backgroundColor","changeHeight","height","changeBackgroundImage","backgroundImage","optionsModal","mode","moveComponent","componentOptions","deleteComponent","UserComp","componentInfo","contentStyle","userStyle","componentUserOverrideStyle","componentProps","optionsProps","includes","modalProps"],"mappings":"m4BAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,MAAOC,CAAAA,gBAAP,KAA6B,gCAA7B,CAEA,OAASC,QAAT,KAAyB,4BAAzB,CACA,MAAOC,CAAAA,UAAP,KAAuB,oBAAvB,CACA,MAAOC,CAAAA,eAAP,KAA4B,yBAA5B,CACA,OAASC,IAAT,KAAqB,QAArB,CACA,MAAO,qCAAP,CACA,MAAOC,CAAAA,QAAP,KAAqB,yBAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,mBAAlB,CAEA,yE,GACMC,CAAAA,iB,sHACJ,2BAAaC,KAAb,CAAoB,mDAClB,uBAAMA,KAAN,EADkB,MAWpBC,eAXoB,CAWF,SAACC,CAAD,CAAM,iBACW,MAAKF,KADhB,CACdG,aADc,aACdA,aADc,CACCC,IADD,aACCA,IADD,CAEtB,GAAMC,CAAAA,QAAQ,CAAGH,CAAC,CAACI,MAAF,CAASC,UAAT,CAAoB,SAApB,EAA+BC,KAAhD,CACA,GAAMC,CAAAA,aAAa,CAAGX,KAAK,CAACY,UAAN,CAAiBP,aAAjB,CAAgCC,IAAhC,CAAtB,CACA,MAAKO,QAAL,CAAc,CACZC,eAAe,CAAE,IADL,CAEZC,iBAAiB,CAAER,QAFP,CAGZS,qBAAqB,CAAEL,aAAa,CAACM,IAAd,CAAmBV,QAAnB,CAHX,CAIZW,sBAAsB,CAAEP,aAAa,CAACQ,KAAd,CAAoBZ,QAApB,CAJZ,CAAd,EAMD,CArBmB,OAwBpBa,gBAxBoB,CAwBD,UAAK,CACtB,MAAKP,QAAL,CAAc,CACZC,eAAe,CAAE,KADL,CAEZC,iBAAiB,CAAE,EAFP,CAGZC,qBAAqB,CAAE,EAHX,CAIZE,sBAAsB,CAAE,EAJZ,CAAd,EAMD,CA/BmB,OAkCpBG,WAlCoB,0FAkCN,iBAAOjB,CAAP,0OAC4C,MAAKF,KADjD,CACJoB,SADI,cACJA,SADI,CACOhB,IADP,cACOA,IADP,CACaiB,0BADb,cACaA,0BADb,CAENC,IAFM,CAECpB,CAAC,CAACI,MAAF,CAASC,UAAT,CAAoB,SAApB,EAA+BC,KAFhC,CAGNe,IAHM,CAGCrB,CAAC,CAACI,MAAF,CAASkB,KAAT,CAAe,CAAf,CAHD,MAITD,IAAI,CAACE,IAAL,CAAY,KAJH,0BAKVC,KAAK,CAAC,0BAAD,CAAL,CALU,8BAOJC,cAPI,CAOa/B,IAAI,EAPjB,CAQJgC,UARI,CAQS/B,QAAQ,CAACgC,OAAT,GAAmBC,GAAnB,YAA2BjC,QAAQ,CAACkC,IAAT,GAAgBC,WAAhB,CAA4BC,GAAvD,aAA8Db,SAA9D,aAA2EO,cAA3E,EART,wBASJC,CAAAA,UAAU,CAACM,GAAX,CAAeX,IAAf,CATI,gCAUgBK,CAAAA,UAAU,CAACO,cAAX,EAVhB,SAUJC,WAVI,eAWVf,0BAA0B,CAACjB,IAAD,CAAOkB,IAAP,CAAa,CAAEe,GAAG,CAAED,WAAP,CAAb,CAA1B,CAXU,uDAlCM,qEAkDpBE,OAlDoB,CAkDV,UAAM,kBAC8C,MAAKtC,KADnD,CACNI,IADM,cACNA,IADM,CACAiB,0BADA,cACAA,0BADA,CAC4BlB,aAD5B,cAC4BA,aAD5B,CAEd,GAAMoC,CAAAA,mBAAmB,CAAGzC,KAAK,CAACY,UAAN,CAAiBP,aAAjB,CAAgCC,IAAhC,EAAsCW,IAAlE,CACA,GAAMyB,CAAAA,QAAQ,CAAG,EAAjB,CACA,IAAK,GAAMC,CAAAA,GAAX,GAAkBF,CAAAA,mBAAlB,CAAuC,CACrC,GAAGA,mBAAmB,CAACE,GAAD,CAAnB,CAAyBC,IAAzB,GAAkC,MAArC,CAA6C,SAC7CF,QAAQ,CAACG,IAAT,CAAcC,QAAQ,CAACH,GAAG,CAACI,KAAJ,CAAU,MAAV,EAAkB,CAAlB,CAAD,CAAtB,EACD,CACD,GAAGL,QAAQ,CAACM,MAAT,EAAmB,CAAtB,CAAyB,OACzB,GAAIC,CAAAA,OAAO,CAAG,EAAd,CACA,GAAG,CAACP,QAAQ,CAACM,MAAb,CAAqBC,OAAO,CAAG,OAAV,CAArB,IACKA,CAAAA,OAAO,eAAUC,IAAI,CAACC,GAAL,OAAAD,IAAI,CAAQR,QAAR,CAAJ,CAAsB,CAAhC,CAAP,CACL;AACA,GAAMU,CAAAA,OAAO,CAAG,CAAEjC,KAAK,CAAE,CAAEkC,QAAQ,CAAE,MAAZ,CAAoBC,aAAa,CAAE,SAAnC,CAAT,CAAyDV,IAAI,CAAE,MAA/D,CAAuEW,IAAI,CAAE,UAA7E,CAAyFC,IAAI,CAAE,sBAA/F,CAAuHC,SAAS,CAAC,IAAjI,CAAhB,CACAlC,0BAA0B,CAACjB,IAAD,CAAO2C,OAAP,CAAgBG,OAAhB,CAA1B,CACD,CAjEmB,OAoEpBM,UApEoB,CAoEP,SAACtD,CAAD,CAAO,kBAC2B,MAAKF,KADhC,CACVI,IADU,cACVA,IADU,CACJiB,0BADI,cACJA,0BADI,IAEVR,CAAAA,iBAFU,CAEY,MAAK4C,KAFjB,CAEV5C,iBAFU,CAGlBQ,0BAA0B,CAACjB,IAAD,CAAOS,iBAAP,CAA0B6C,SAA1B,CAA1B,CACA,MAAKxC,gBAAL,GACD,CAzEmB,OA4EpByC,UA5EoB,CA4EP,SAAC5C,IAAD,CAAU,IACbF,CAAAA,iBADa,CACS,MAAK4C,KADd,CACb5C,iBADa,kBAEwB,MAAKb,KAF7B,CAEbI,IAFa,cAEbA,IAFa,CAEPiB,0BAFO,cAEPA,0BAFO,CAGrBA,0BAA0B,CAACjB,IAAD,CAAOS,iBAAP,CAA0BE,IAA1B,CAA1B,CACA,MAAKG,gBAAL,GACD,CAjFmB,OAoFpB0C,WApFoB,CAoFN,SAACC,KAAD,CAAW,kBAC+B,MAAK7D,KADpC,CACfI,IADe,cACfA,IADe,CACT0D,mCADS,cACTA,mCADS,CAEvBA,mCAAmC,CAAC1D,IAAD,CAAO,CAAC2D,eAAe,CAAEF,KAAlB,CAAP,CAAnC,CACD,CAvFmB,OA0FpBG,YA1FoB,CA0FL,SAACC,MAAD,CAAY,kBAC6B,MAAKjE,KADlC,CACjBI,IADiB,cACjBA,IADiB,CACX0D,mCADW,cACXA,mCADW,CAEzBA,mCAAmC,CAAC1D,IAAD,CAAO,CAAE6D,MAAM,CAANA,MAAF,CAAP,CAAnC,CACD,CA7FmB,OAgGpBC,qBAhGoB,2FAgGI,kBAAOhE,CAAP,kPAC2C,MAAKF,KADhD,CACdoB,SADc,cACdA,SADc,CACHhB,IADG,cACHA,IADG,CACG0D,mCADH,cACGA,mCADH,CAEhBvC,IAFgB,CAETrB,CAAC,CAACI,MAAF,CAASkB,KAAT,CAAe,CAAf,CAFS,MAGnBD,IAAI,CAACE,IAAL,CAAY,MAHO,2BAIpBC,KAAK,CAAC,0BAAD,CAAL,CAJoB,+BAMdC,cANc,CAMG/B,IAAI,EANP,CAOdgC,UAPc,CAOD/B,QAAQ,CAACgC,OAAT,GAAmBC,GAAnB,YAA2BjC,QAAQ,CAACkC,IAAT,GAAgBC,WAAhB,CAA4BC,GAAvD,aAA8Db,SAA9D,aAA2EO,cAA3E,EAPC,yBAQdC,CAAAA,UAAU,CAACM,GAAX,CAAeX,IAAf,CARc,iCASMK,CAAAA,UAAU,CAACO,cAAX,EATN,SASdC,WATc,gBAUpB0B,mCAAmC,CAAC1D,IAAD,CAAO,CAAE+D,eAAe,iBAAU/B,WAAV,OAAjB,CAAP,CAAnC,CAVoB,yDAhGJ,iEAElB,MAAKqB,KAAL,CAAa,CACXW,YAAY,CAAE,KADH,CAEXvD,iBAAiB,CAAE,EAFR,CAGXC,qBAAqB,CAAE,EAHZ,CAIXE,sBAAsB,CAAE,EAJb,CAAb,CAFkB,aAQnB,CAED,4D,8CAoGA,gE,uBACU,kBACiF,KAAKhB,KADtF,CACAqE,IADA,cACAA,IADA,CACMC,aADN,cACMA,aADN,CACqBC,gBADrB,cACqBA,gBADrB,CACuCnE,IADvC,cACuCA,IADvC,CAC6CoE,eAD7C,cAC6CA,eAD7C,CAC8DrE,aAD9D,cAC8DA,aAD9D,iBAEsF,KAAKsD,KAF3F,CAEA5C,iBAFA,aAEAA,iBAFA,CAEmBD,eAFnB,aAEmBA,eAFnB,CAEoCE,qBAFpC,aAEoCA,qBAFpC,CAE2DE,sBAF3D,aAE2DA,sBAF3D,CAGR,GAAMyD,CAAAA,QAAQ,CAAGjF,gBAAgB,CAACY,IAAD,CAAjC,CAHQ,sBAIoFN,KAAK,CAACY,UAAN,CAAiBP,aAAjB,CAAgCC,IAAhC,CAJpF,CAIMsE,aAJN,mBAIA3D,IAJA,CAI4B4D,YAJ5B,mBAIqB1D,KAJrB,CAIsE2D,SAJtE,mBAI0CC,0BAJ1C,CAKR,GAAMC,CAAAA,cAAc,CAAG,EAAvB,CACAA,cAAc,CAAC,MAAD,CAAd,CAAyBJ,aAAzB,CACAI,cAAc,CAAC,cAAD,CAAd,CAAiCH,YAAjC,CACAG,cAAc,CAAC,WAAD,CAAd,CAA8BF,SAA9B,CACA,GAAGP,IAAI,GAAK,MAAZ,CAAmB,CACjBS,cAAc,CAAC,iBAAD,CAAd,CAAoC,KAAK7E,eAAzC,CACA6E,cAAc,CAAC,aAAD,CAAd,CAAgC,KAAK3D,WAArC,CACD,CACD,GAAM4D,CAAAA,YAAY,CAAG,EAArB,CACAA,YAAY,CAAC,MAAD,CAAZ,CAAuB3E,IAAvB,CACA2E,YAAY,CAAC,iBAAD,CAAZ,CAAkCP,eAAlC,CACAO,YAAY,CAAC,eAAD,CAAZ,CAAgCT,aAAhC,CACAS,YAAY,CAAC,gBAAD,CAAZ,CAAiCH,SAAjC,CACA,GAAGL,gBAAgB,CAACS,QAAjB,CAA0B,cAA1B,CAAH,CAA8CD,YAAY,CAAC,cAAD,CAAZ,CAA+B,KAAKf,YAApC,CAC9C,GAAGO,gBAAgB,CAACS,QAAjB,CAA0B,UAA1B,CAAH,CAA0CD,YAAY,CAAC,SAAD,CAAZ,CAA0B,KAAKzC,OAA/B,CAC1C,GAAGiC,gBAAgB,CAACS,QAAjB,CAA0B,iBAA1B,CAAH,CAAiDD,YAAY,CAAC,aAAD,CAAZ,CAA8B,KAAKnB,WAAnC,CACjD,GAAGW,gBAAgB,CAACS,QAAjB,CAA0B,iBAA1B,CAAH,CAAiDD,YAAY,CAAC,uBAAD,CAAZ,CAAwC,KAAKb,qBAA7C,CAEjD,GAAMe,CAAAA,UAAU,CAAG,EAAnB,CACAA,UAAU,CAAC,mBAAD,CAAV,CAAkCpE,iBAAlC,CACAoE,UAAU,CAAC,SAAD,CAAV,CAAwB,KAAK/D,gBAA7B,CACA+D,UAAU,CAAC,OAAD,CAAV,CAAsBjE,sBAAtB,CACAiE,UAAU,CAAC,YAAD,CAAV,CAA2B,KAAKzB,UAAhC,CACAyB,UAAU,CAAC,YAAD,CAAV,CAA2B,KAAKtB,UAAhC,CACAsB,UAAU,CAAC,MAAD,CAAV,CAAqBnE,qBAArB,CACAmE,UAAU,CAAC,MAAD,CAAV,CAAqB7E,IAArB,CAEA,mBACE,oBAAC,QAAD,kBAAc0E,cAAd,EAA8B,IAAI,CAAET,IAApC,GACGA,IAAI,GAAK,MAAT,eAAmB,oBAAC,UAAD,CAAgBU,YAAhB,CADtB,CAEGnE,eAAe,eAAI,oBAAC,eAAD,CAAqBqE,UAArB,CAFtB,CADF,CAMD,C,+BAtJ6B1F,S,EA6JhC,cAAeE,CAAAA,QAAQ,CAACM,iBAAD,CAAvB","sourcesContent":["import React, { Component } from 'react'\nimport MATCH_COMPONENTS from '../../utils/componentsMatching'\nimport PropTypes from 'prop-types'\nimport { withData } from '../../contexts/dataContext'\nimport OptionsBar from '../droy/OptionsBar'\nimport ModalChangeInfo from '../droy/ModalChangeInfo'\nimport { uuid } from 'uuidv4'\nimport '../../styles/user-componentBase.css'\nimport firebase from '../../services/firebase'\nimport alias from '../../utils/alias'\n\n/* Provides all the funcions to manage all component content and style */\nclass UserComponentBase extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      optionsModal: false,\n      attributeSelected: '',\n      attributeSelectedInfo: '',\n      attributeSelectedStyle: ''\n    }\n  }\n  \n  /* Opens the editor modal setting the target to the state */\n  handleOpenModal = (e) =>{\n    const { userLayoutObj, code  } = this.props\n    const attrCode = e.target.attributes['data-id'].value\n    const attributeInfo = alias.findByCode(userLayoutObj, code)\n    this.setState({\n      openChangeModal: true,\n      attributeSelected: attrCode,\n      attributeSelectedInfo: attributeInfo.info[attrCode],\n      attributeSelectedStyle: attributeInfo.style[attrCode]\n    })\n  }\n\n  /* Close the editor modal */\n  handleCloseModal = () =>{\n    this.setState({\n      openChangeModal: false,\n      attributeSelected: '',\n      attributeSelectedInfo: '',\n      attributeSelectedStyle: ''\n    })\n  }\n  \n  /* Uploads the recived image to Firebase Storage and updates the context */\n  changeImage = async (e) => {\n    const { projectId, code, saveComponentInfoToContext } = this.props\n    const attr = e.target.attributes['data-id'].value\n    const file = e.target.files[0]\n    if(file.size > 70000){\n      alert('Imagen demasiado grande.')\n    } else {\n      const randomFileName = uuid()\n      const storageRef = firebase.storage().ref(`/${firebase.auth().currentUser.uid}/${projectId}/${randomFileName}`)\n      await storageRef.put(file)\n      const downloadUrl = await storageRef.getDownloadURL()\n      saveComponentInfoToContext(code, attr, { src: downloadUrl })\n    }\n  }\n\n  /* Ads a new link in the target component and updates the context */\n  addLink = () => {\n    const { code, saveComponentInfoToContext, userLayoutObj } = this.props\n    const targetComponentInfo = alias.findByCode(userLayoutObj, code).info\n    const linksIds = [] \n    for (const key in targetComponentInfo) {\n      if(targetComponentInfo[key].type !== 'link') continue\n      linksIds.push(parseInt(key.match(/\\d+$/)[0]))\n    }\n    if(linksIds.length >= 5) return\n    let newAttr = ''\n    if(!linksIds.length) newAttr = 'link1'\n    else newAttr = `link${Math.max(...linksIds)+1}`\n    // Cambiar link por default a pagina de quienes somos de Droy\n    const newInfo = { style: { fontSize: '1rem', letterSpacing: 'inherit' }, type: 'link', text: \"New link\", href: 'http://www.google.es', toNewPage:true}\n    saveComponentInfoToContext(code, newAttr, newInfo)\n  }\n\n  /* Deletes the target link in the target component and updates the context */\n  deleteLink = (e) => {\n    const { code, saveComponentInfoToContext } = this.props\n    const { attributeSelected } = this.state\n    saveComponentInfoToContext(code, attributeSelected, undefined)\n    this.handleCloseModal()\n  }\n\n  /* Recieves the new text info to set to the target component and updates the context */\n  changeInfo = (info) => {\n    const { attributeSelected } = this.state\n    const { code, saveComponentInfoToContext } = this.props\n    saveComponentInfoToContext(code, attributeSelected, info)\n    this.handleCloseModal()\n  }\n\n  /* Recieves the color HEX to set to the target componetn and updates de context */\n  changeColor = (color) => {\n    const { code, saveUserComponentStyleInfoToContext } = this.props\n    saveUserComponentStyleInfoToContext(code, {backgroundColor: color})\n  }\n\n  /* Recieves the value of de new height to set to the target component and updates de context */\n  changeHeight = (height) => {\n    const { code, saveUserComponentStyleInfoToContext } = this.props\n    saveUserComponentStyleInfoToContext(code, { height })\n  }\n\n  /* Uploads the recived image to Firebase Storage and updates the context */\n  changeBackgroundImage = async (e) => {\n    const { projectId, code, saveUserComponentStyleInfoToContext } = this.props\n    const file = e.target.files[0]\n    if(file.size > 700000){\n      alert('Imagen demasiado grande.')\n    } else {\n      const randomFileName = uuid()\n      const storageRef = firebase.storage().ref(`/${firebase.auth().currentUser.uid}/${projectId}/${randomFileName}`)\n      await storageRef.put(file)\n      const downloadUrl = await storageRef.getDownloadURL()\n      saveUserComponentStyleInfoToContext(code, { backgroundImage: `url(\"${downloadUrl}\")` })\n    }\n  } \n\n  /* Gets the real React components and pass new funcionalities */\n  render () {\n    const { mode, moveComponent, componentOptions, code, deleteComponent, userLayoutObj  } = this.props\n    const { attributeSelected, openChangeModal, attributeSelectedInfo, attributeSelectedStyle } = this.state\n    const UserComp = MATCH_COMPONENTS[code]\n    const { info: componentInfo, style: contentStyle, componentUserOverrideStyle: userStyle } = alias.findByCode(userLayoutObj, code)\n    const componentProps = {}\n    componentProps['info'] = componentInfo\n    componentProps['contentStyle'] = contentStyle\n    componentProps['userStyle'] = userStyle\n    if(mode === 'edit'){\n      componentProps['openChangeModal'] = this.handleOpenModal\n      componentProps['changeImage'] = this.changeImage\n    }\n    const optionsProps = {}\n    optionsProps['code'] = code\n    optionsProps['deleteComponent'] = deleteComponent\n    optionsProps['moveComponent'] = moveComponent\n    optionsProps['componentStyle'] = userStyle\n    if(componentOptions.includes('changeHeight')) optionsProps['changeHeight'] = this.changeHeight\n    if(componentOptions.includes('addLinks')) optionsProps['addLink'] = this.addLink\n    if(componentOptions.includes('backgroundColor')) optionsProps['changeColor'] = this.changeColor\n    if(componentOptions.includes('backgroundImage')) optionsProps['changeBackgroundImage'] = this.changeBackgroundImage \n\n    const modalProps = {}\n    modalProps['attributeSelected'] = attributeSelected\n    modalProps['onClose'] = this.handleCloseModal\n    modalProps['style'] = attributeSelectedStyle\n    modalProps['deleteLink'] = this.deleteLink\n    modalProps['changeInfo'] = this.changeInfo\n    modalProps['info'] = attributeSelectedInfo\n    modalProps['code'] = code\n\n    return (\n      <UserComp {...componentProps} mode={mode}>\n        {mode === \"edit\" && <OptionsBar {...optionsProps}/>}\n        {openChangeModal && <ModalChangeInfo {...modalProps}/>}\n      </UserComp>\n    )\n  }\n}\n\nUserComponentBase.propTypes = {\n  code: PropTypes.string\n}\n\nexport default withData(UserComponentBase)\n"]},"metadata":{},"sourceType":"module"}