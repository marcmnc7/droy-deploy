{"ast":null,"code":"import _regeneratorRuntime from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/ironhacker/Documents/M3/droy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import MATCH_COMPONENTS from'../../utils/componentsMatching';import{withData}from'../../contexts/dataContext';import OptionsBar from'../droy/OptionsBar';import ModalChangeInfo from'../droy/ModalChangeInfo';import{uuid}from'uuidv4';import'../../styles/user-componentBase.css';import firebase from'../../services/firebase';/* Provides all the funcions to manage all component content and style */var UserComponentBase=/*#__PURE__*/function(_Component){_inherits(UserComponentBase,_Component);var _super=_createSuper(UserComponentBase);function UserComponentBase(props){var _this;_classCallCheck(this,UserComponentBase);_this=_super.call(this,props);_this.handleOpenModal=function(e){var _this$props=_this.props,userLayoutObj=_this$props.userLayoutObj,code=_this$props.code;var attrCode=e.target.attributes['data-id'].value;_this.setState({openChangeModal:true,attributeSelected:attrCode,attributeSelectedInfo:userLayoutObj.find(function(c){return c.code===code;}).info[attrCode]});};_this.handleCloseModal=function(){_this.setState({openChangeModal:false,attributeSelected:'',attributeSelectedInfo:''});};_this.changeImage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _this$props2,projectId,code,saveComponentInfoToContext,attr,file,randomFileName,storageRef,downloadUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props2=_this.props,projectId=_this$props2.projectId,code=_this$props2.code,saveComponentInfoToContext=_this$props2.saveComponentInfoToContext;attr=e.target.attributes['data-id'].value;file=e.target.files[0];if(!(file.size>20000)){_context.next=7;break;}alert('Imagen demasiado grande.');_context.next=15;break;case 7:randomFileName=uuid();storageRef=firebase.storage().ref(\"/\".concat(firebase.auth().currentUser.uid,\"/\").concat(projectId,\"/\").concat(randomFileName));_context.next=11;return storageRef.put(file);case 11:_context.next=13;return storageRef.getDownloadURL();case 13:downloadUrl=_context.sent;saveComponentInfoToContext(code,attr,{src:downloadUrl});case 15:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.addLink=function(){var _this$props3=_this.props,code=_this$props3.code,saveComponentInfoToContext=_this$props3.saveComponentInfoToContext,userLayoutObj=_this$props3.userLayoutObj;var targetComponentInfo=userLayoutObj.find(function(c){return c.code===code;}).info;var linksIds=[];for(var key in targetComponentInfo){if(targetComponentInfo[key].type!=='link')continue;linksIds.push(parseInt(key.match(/\\d+$/)[0]));}if(linksIds.length>=5)return;var newAttr='';if(!linksIds.length)newAttr='link1';else newAttr=\"link\".concat(Math.max.apply(Math,linksIds)+1);// Cambiar link por default a pagina de quienes somos de Droy\nvar newInfo={type:'link',text:\"New link\",href:'http://www.google.es',toNewPage:true};saveComponentInfoToContext(code,newAttr,newInfo);};_this.deleteLink=function(e){var _this$props4=_this.props,code=_this$props4.code,saveComponentInfoToContext=_this$props4.saveComponentInfoToContext;var attributeSelected=_this.state.attributeSelected;saveComponentInfoToContext(code,attributeSelected,undefined);_this.handleCloseModal();};_this.changeInfo=function(info){var attributeSelected=_this.state.attributeSelected;var _this$props5=_this.props,code=_this$props5.code,saveComponentInfoToContext=_this$props5.saveComponentInfoToContext;saveComponentInfoToContext(code,attributeSelected,info);_this.handleCloseModal();};_this.changeColor=function(color){var _this$props6=_this.props,code=_this$props6.code,saveUserComponentStyleInfoToContext=_this$props6.saveUserComponentStyleInfoToContext;saveUserComponentStyleInfoToContext(code,{backgroundColor:color});};_this.state={optionsModal:false,attributeSelected:'',attributeSelectedInfo:''};return _this;}/* Opens the editor modal setting the target to the state */_createClass(UserComponentBase,[{key:\"render\",/* Gets the real React components and pass new funcionalities */value:function render(){var _this$props7=this.props,mode=_this$props7.mode,moveComponent=_this$props7.moveComponent,componentType=_this$props7.componentType,code=_this$props7.code,deleteComponent=_this$props7.deleteComponent,userLayoutObj=_this$props7.userLayoutObj;var _this$state=this.state,attributeSelected=_this$state.attributeSelected,openChangeModal=_this$state.openChangeModal,attributeSelectedInfo=_this$state.attributeSelectedInfo;var UserComp=MATCH_COMPONENTS[code];var _userLayoutObj$find=userLayoutObj.find(function(c){return c.code===code;}),componentInfo=_userLayoutObj$find.info,userStyle=_userLayoutObj$find.componentUserOverrideStyle;var componentProps={};if(mode==='edit'){componentProps['openChangeModal']=this.handleOpenModal;componentProps['changeImage']=this.changeImage;if(componentType===\"nav\")componentProps['addLink']=this.addLink;}componentProps['info']=componentInfo;componentProps['userStyle']=userStyle;return/*#__PURE__*/React.createElement(UserComp,Object.assign({},componentProps,{mode:mode}),mode===\"edit\"&&/*#__PURE__*/React.createElement(OptionsBar,{changeColor:this.changeColor,addLink:this.addLink,componentType:componentType,code:code,deleteComponent:deleteComponent,moveComponent:moveComponent}),mode===\"edit\"&&openChangeModal&&/*#__PURE__*/React.createElement(ModalChangeInfo,{deleteLink:this.deleteLink,info:attributeSelectedInfo,code:code,attributeSelected:attributeSelected,changeInfo:this.changeInfo,onClose:this.handleCloseModal}));}}]);return UserComponentBase;}(Component);export default withData(UserComponentBase);","map":{"version":3,"sources":["/home/ironhacker/Documents/M3/droy/src/components/droy/UserComponentBase.js"],"names":["React","Component","MATCH_COMPONENTS","withData","OptionsBar","ModalChangeInfo","uuid","firebase","UserComponentBase","props","handleOpenModal","e","userLayoutObj","code","attrCode","target","attributes","value","setState","openChangeModal","attributeSelected","attributeSelectedInfo","find","c","info","handleCloseModal","changeImage","projectId","saveComponentInfoToContext","attr","file","files","size","alert","randomFileName","storageRef","storage","ref","auth","currentUser","uid","put","getDownloadURL","downloadUrl","src","addLink","targetComponentInfo","linksIds","key","type","push","parseInt","match","length","newAttr","Math","max","newInfo","text","href","toNewPage","deleteLink","state","undefined","changeInfo","changeColor","color","saveUserComponentStyleInfoToContext","backgroundColor","optionsModal","mode","moveComponent","componentType","deleteComponent","UserComp","componentInfo","userStyle","componentUserOverrideStyle","componentProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport MATCH_COMPONENTS from '../../utils/componentsMatching'\nimport PropTypes from 'prop-types'\nimport { withData } from '../../contexts/dataContext'\nimport OptionsBar from '../droy/OptionsBar'\nimport ModalChangeInfo from '../droy/ModalChangeInfo'\nimport { uuid } from 'uuidv4'\nimport '../../styles/user-componentBase.css'\nimport firebase from '../../services/firebase'\n\n/* Provides all the funcions to manage all component content and style */\nclass UserComponentBase extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      optionsModal: false,\n      attributeSelected: '',\n      attributeSelectedInfo: ''\n    }\n  }\n  \n  /* Opens the editor modal setting the target to the state */\n  handleOpenModal = (e) =>{\n    const { userLayoutObj, code  } = this.props\n    const attrCode = e.target.attributes['data-id'].value\n    this.setState({\n      openChangeModal: true,\n      attributeSelected: attrCode,\n      attributeSelectedInfo: userLayoutObj.find(c => c.code === code).info[attrCode]\n    })\n  }\n\n  /* Close the editor modal */\n  handleCloseModal = () =>{\n    this.setState({\n      openChangeModal: false,\n      attributeSelected: '',\n      attributeSelectedInfo: ''\n    })\n  }\n  \n  /* Uploads the recived image to Firebase Storage and updates the context */\n  changeImage = async (e) => {\n    const { projectId, code, saveComponentInfoToContext } = this.props\n    const attr = e.target.attributes['data-id'].value\n    const file = e.target.files[0]\n    if(file.size > 20000){\n      alert('Imagen demasiado grande.')\n    } else {\n      const randomFileName = uuid()\n      const storageRef = firebase.storage().ref(`/${firebase.auth().currentUser.uid}/${projectId}/${randomFileName}`)\n      await storageRef.put(file)\n      const downloadUrl = await storageRef.getDownloadURL()\n      saveComponentInfoToContext(code, attr, { src: downloadUrl })\n    }\n  }\n\n  /* Ads a new link in the target component and updates the context */\n  addLink = () => {\n    const { code, saveComponentInfoToContext, userLayoutObj } = this.props\n    const targetComponentInfo = userLayoutObj.find(c => c.code === code).info\n    const linksIds = [] \n    for (const key in targetComponentInfo) {\n      if(targetComponentInfo[key].type !== 'link') continue\n      linksIds.push(parseInt(key.match(/\\d+$/)[0]))\n    }\n    if(linksIds.length >= 5) return\n    let newAttr = ''\n    if(!linksIds.length) newAttr = 'link1'\n    else newAttr = `link${Math.max(...linksIds)+1}`\n    // Cambiar link por default a pagina de quienes somos de Droy\n    const newInfo = { type: 'link', text: \"New link\", href: 'http://www.google.es', toNewPage:true}\n    saveComponentInfoToContext(code, newAttr, newInfo)\n  }\n\n  /* Deletes the target link in the target component and updates the context */\n  deleteLink = (e) => {\n    const { code, saveComponentInfoToContext } = this.props\n    const { attributeSelected } = this.state\n    saveComponentInfoToContext(code, attributeSelected, undefined)\n    this.handleCloseModal()\n  }\n\n  /* Recieves the new text info to set to the target component and updates the context */\n  changeInfo = (info) => {\n    const { attributeSelected } = this.state\n    const { code, saveComponentInfoToContext } = this.props\n    saveComponentInfoToContext(code, attributeSelected, info)\n    this.handleCloseModal()\n  }\n\n  /* Recieves the color HEX to set to the target componetn and updates de context */\n  changeColor = (color) => {\n    const { code, saveUserComponentStyleInfoToContext } = this.props\n    saveUserComponentStyleInfoToContext(code, {backgroundColor: color})\n  }\n\n  /* Gets the real React components and pass new funcionalities */\n  render () {\n    const { mode, moveComponent, componentType, code, deleteComponent, userLayoutObj  } = this.props\n    const { attributeSelected, openChangeModal, attributeSelectedInfo } = this.state\n    const UserComp = MATCH_COMPONENTS[code]\n    const { info: componentInfo, componentUserOverrideStyle: userStyle } = userLayoutObj.find(c => c.code === code)\n    const componentProps = {}\n    if(mode === 'edit'){\n      componentProps['openChangeModal'] = this.handleOpenModal\n      componentProps['changeImage'] = this.changeImage\n      if(componentType === \"nav\") componentProps['addLink'] = this.addLink\n    }\n    componentProps['info'] = componentInfo\n    componentProps['userStyle'] = userStyle\n    return (\n      <UserComp {...componentProps} mode={mode}>\n        {mode === \"edit\" && <OptionsBar changeColor={this.changeColor} addLink={this.addLink} componentType={componentType} code={code} deleteComponent={deleteComponent} moveComponent={moveComponent}/>}\n        {mode === \"edit\" && openChangeModal && <ModalChangeInfo deleteLink={this.deleteLink} info={attributeSelectedInfo} code={code} attributeSelected={attributeSelected} changeInfo={this.changeInfo} onClose={this.handleCloseModal}/>}\n      </UserComp>\n    )\n  }\n}\n\nUserComponentBase.propTypes = {\n  code: PropTypes.string\n}\n\nexport default withData(UserComponentBase)\n"]},"metadata":{},"sourceType":"module"}